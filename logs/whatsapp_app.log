2025-05-29 11:35:24,979 - INFO - Starting WhatsApp FastAPI app
2025-05-29 11:35:24,980 - INFO - Will watch for changes in these directories: ['C:\\Users\\Jhajharia\\Desktop\\NasherMiles AI']
2025-05-29 11:35:24,981 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-29 11:35:24,981 - INFO - Started reloader process [15760] using StatReload
2025-05-29 11:35:36,595 - INFO - Started server process [28560]
2025-05-29 11:35:36,596 - INFO - Waiting for application startup.
2025-05-29 11:35:38,389 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-29 11:35:38,411 - INFO - Starting the FastAPI app with lifespan.
2025-05-29 11:35:38,411 - INFO - Application startup complete.
2025-05-29 11:36:07,121 - WARNING - StatReload detected changes in 'whatsapp_api.py'. Reloading...
2025-05-29 11:36:07,249 - INFO - Shutting down
2025-05-29 11:36:07,359 - INFO - Waiting for application shutdown.
2025-05-29 11:36:07,359 - INFO - Shutting down server and ngrok tunnel...
2025-05-29 11:36:07,360 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-29 11:36:07,360 - INFO - Application shutdown complete.
2025-05-29 11:36:07,361 - INFO - Finished server process [28560]
2025-05-29 11:36:18,502 - WARNING - StatReload detected changes in 'whatsapp_api.py'. Reloading...
2025-05-29 11:36:29,399 - INFO - Started server process [17900]
2025-05-29 11:36:29,401 - INFO - Waiting for application startup.
2025-05-29 11:36:29,888 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-29 11:36:29,895 - INFO - Starting the FastAPI app with lifespan.
2025-05-29 11:36:29,895 - INFO - Application startup complete.
2025-05-29 11:36:51,631 - WARNING - Webhook verification failed
2025-05-29 11:36:51,631 - ERROR - Error during verification: 403: Verification failed
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 337, in verify_webhook
    raise HTTPException(status_code=403, detail="Verification failed")
fastapi.exceptions.HTTPException: 403: Verification failed
2025-05-29 11:36:51,633 - INFO - 2a03:2880:3ff:8:::0 - "GET /webhook?hub.mode=subscribe&hub.challenge=582070508&hub.verify_token=hello HTTP/1.1" 500
2025-05-29 11:37:13,587 - WARNING - StatReload detected changes in 'whatsapp_api.py'. Reloading...
2025-05-29 11:37:13,650 - INFO - Shutting down
2025-05-29 11:37:13,761 - INFO - Waiting for application shutdown.
2025-05-29 11:37:13,762 - INFO - Shutting down server and ngrok tunnel...
2025-05-29 11:37:13,762 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-29 11:37:13,763 - INFO - Application shutdown complete.
2025-05-29 11:37:13,763 - INFO - Finished server process [17900]
2025-05-29 11:37:26,414 - INFO - Started server process [30320]
2025-05-29 11:37:26,415 - INFO - Waiting for application startup.
2025-05-29 11:37:27,411 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-29 11:37:27,416 - INFO - Starting the FastAPI app with lifespan.
2025-05-29 11:37:27,416 - INFO - Application startup complete.
2025-05-29 11:37:37,269 - INFO - Webhook verification successful
2025-05-29 11:37:37,270 - INFO - 2a03:2880:3ff:8:::0 - "GET /webhook?hub.mode=subscribe&hub.challenge=678884714&hub.verify_token=hello HTTP/1.1" 200
2025-05-29 11:39:38,774 - INFO - Shutting down
2025-05-29 11:39:38,885 - INFO - Waiting for application shutdown.
2025-05-29 11:39:38,886 - INFO - Shutting down server and ngrok tunnel...
2025-05-29 11:39:38,886 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-29 11:39:38,887 - INFO - Application shutdown complete.
2025-05-29 11:39:38,887 - INFO - Finished server process [30320]
2025-05-29 11:39:41,301 - INFO - Stopping reloader process [15760]
2025-05-29 11:40:45,157 - INFO - Starting WhatsApp FastAPI app
2025-05-29 11:40:45,158 - INFO - Will watch for changes in these directories: ['C:\\Users\\Jhajharia\\Desktop\\NasherMiles AI']
2025-05-29 11:40:45,158 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-29 11:40:45,159 - INFO - Started reloader process [3832] using StatReload
2025-05-29 11:40:57,886 - INFO - Started server process [19240]
2025-05-29 11:40:57,887 - INFO - Waiting for application startup.
2025-05-29 11:41:01,880 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-29 11:41:01,887 - INFO - Starting the FastAPI app with lifespan.
2025-05-29 11:41:01,887 - INFO - Application startup complete.
2025-05-29 11:41:06,734 - INFO - 2a03:2880:10ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-05-29 11:41:28,921 - INFO - 2a03:2880:22ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-05-29 11:41:48,832 - INFO - Shutting down
2025-05-29 11:41:48,942 - INFO - Waiting for application shutdown.
2025-05-29 11:41:48,942 - INFO - Shutting down server and ngrok tunnel...
2025-05-29 11:41:48,943 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-29 11:41:48,943 - INFO - Application shutdown complete.
2025-05-29 11:41:48,943 - INFO - Finished server process [19240]
2025-05-29 11:41:50,937 - INFO - Stopping reloader process [3832]
2025-05-29 11:42:42,371 - INFO - Starting WhatsApp FastAPI app
2025-05-29 11:42:42,467 - INFO - Started server process [31868]
2025-05-29 11:42:42,468 - INFO - Waiting for application startup.
2025-05-29 11:42:44,995 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-29 11:42:45,000 - INFO - Starting the FastAPI app with lifespan.
2025-05-29 11:42:45,001 - INFO - Application startup complete.
2025-05-29 11:42:45,001 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-29 11:42:50,210 - INFO - Inserted new user in DB: 919530251797
2025-05-29 11:42:50,244 - INFO - Received message from 919530251797: Hi
2025-05-29 11:42:50,245 - INFO - 2a03:2880:10ff:::0 - "POST /webhook HTTP/1.1" 200
2025-05-29 11:42:50,246 - INFO - Started message processing for user 919530251797
2025-05-29 11:42:53,259 - INFO - Processing batched messages for 919530251797: Hi
2025-05-29 11:42:58,590 - INFO - Sent response to user 919530251797, seq 1.
2025-05-29 11:43:00,525 - WARNING - Webhook payload does not include a phone number.
2025-05-29 11:43:00,526 - INFO - 2a03:2880:21ff:56:::0 - "POST /webhook HTTP/1.1" 200
2025-05-29 11:43:02,004 - WARNING - Webhook payload does not include a phone number.
2025-05-29 11:43:02,005 - INFO - 2a03:2880:12ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-05-29 11:43:02,007 - WARNING - Webhook payload does not include a phone number.
2025-05-29 11:43:02,007 - INFO - 2a03:2880:12ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-05-29 11:43:36,096 - INFO - User 919530251797 found in Redis cache.
2025-05-29 11:43:36,096 - INFO - Received message from 919530251797: 6monthsmore
2025-05-29 11:43:36,096 - INFO - 2a03:2880:10ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-05-29 11:43:36,097 - INFO - Message queued for user 919530251797 - processing already active
2025-05-29 11:43:39,110 - INFO - Processing batched messages for 919530251797: 6monthsmore
2025-05-29 11:43:43,857 - INFO - Sent response to user 919530251797, seq 2.
2025-05-29 11:43:44,478 - WARNING - Webhook payload does not include a phone number.
2025-05-29 11:43:44,479 - INFO - 2a03:2880:10ff:40:::0 - "POST /webhook HTTP/1.1" 200
2025-05-29 11:43:44,725 - WARNING - Webhook payload does not include a phone number.
2025-05-29 11:43:44,725 - INFO - 2a03:2880:10ff:56:::0 - "POST /webhook HTTP/1.1" 200
2025-05-29 11:43:44,767 - WARNING - Webhook payload does not include a phone number.
2025-05-29 11:43:44,767 - INFO - 2a03:2880:21ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-05-29 11:43:53,990 - INFO - User 919530251797 found in Redis cache.
2025-05-29 11:43:53,991 - INFO - Received message from 919530251797: Rahul20110@iiitd.ac.in
2025-05-29 11:43:53,991 - INFO - 2a03:2880:22ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-05-29 11:43:53,992 - INFO - Message queued for user 919530251797 - processing already active
2025-05-29 11:43:56,997 - INFO - Processing batched messages for 919530251797: Rahul20110@iiitd.ac.in
2025-05-29 11:43:59,453 - INFO - Sent response to user 919530251797, seq 3.
2025-05-29 11:44:00,222 - WARNING - Webhook payload does not include a phone number.
2025-05-29 11:44:00,222 - INFO - 2a03:2880:21ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-05-29 11:44:00,628 - WARNING - Webhook payload does not include a phone number.
2025-05-29 11:44:00,628 - INFO - 2a03:2880:10ff:b:::0 - "POST /webhook HTTP/1.1" 200
2025-05-29 11:46:27,009 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-05-29 11:46:27,010 - INFO - Cleaned up processing task for user 919530251797.
2025-05-29 11:46:27,105 - INFO - User 919530251797 found in Redis cache.
2025-05-29 11:46:27,106 - INFO - Received image from 919530251797
2025-05-29 11:46:27,106 - INFO - 2a03:2880:10ff:5e:::0 - "POST /webhook HTTP/1.1" 200
2025-05-29 11:47:43,708 - INFO - User 919530251797 found in Redis cache.
2025-05-29 11:47:43,709 - INFO - Received document from 919530251797
2025-05-29 11:47:43,709 - INFO - 2a03:2880:22ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 08:19:08,733 - ERROR - t=2025-05-30T08:19:07+0530 lvl=eror msg="heartbeat timeout, terminating session" obj=tunnels.session obj=csess id=75d574873bb4 clientid=821959a2bc35e7840da0741bc21ae116
2025-05-30 08:19:08,878 - ERROR - t=2025-05-30T08:19:08+0530 lvl=eror msg="session closed, starting reconnect loop" obj=tunnels.session obj=csess id=e2ce6b75f2e6 err="session closed"
2025-05-30 08:19:08,915 - ERROR - t=2025-05-30T08:19:08+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="failed to dial ngrok server with address \"connect.ngrok-agent.com:443\": dial tcp: lookup connect.ngrok-agent.com: no such host"
2025-05-30 08:19:09,453 - ERROR - t=2025-05-30T08:19:09+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="failed to dial ngrok server with address \"connect.ngrok-agent.com:443\": dial tcp: lookup connect.ngrok-agent.com: no such host"
2025-05-30 08:19:11,290 - ERROR - t=2025-05-30T08:19:11+0530 lvl=eror msg="session closed, starting reconnect loop" obj=tunnels.session obj=csess id=e2ce6b75f2e6 err="read tcp 192.168.1.15:51737->13.232.27.141:443: wsarecv: An established connection was aborted by the software in your host machine."
2025-05-30 08:19:11,405 - ERROR - t=2025-05-30T08:19:11+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="failed to dial ngrok server with address \"connect.ngrok-agent.com:443\": dial tcp: lookup connect.ngrok-agent.com: no such host"
2025-05-30 08:19:12,317 - ERROR - t=2025-05-30T08:19:12+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="authentication failed: Your account is limited to 1 simultaneous ngrok agent sessions.\nYou can run multiple simultaneous tunnels from a single agent session by defining the tunnels in your agent configuration file and starting them with the command `ngrok start --all`.\nRead more about the agent configuration file: https://ngrok.com/docs/secure-tunnels/ngrok-agent/reference/config\nYou can view your current agent sessions in the dashboard:\nhttps://dashboard.ngrok.com/agents\r\n\r\nERR_NGROK_108\r\n"
2025-05-30 08:19:13,509 - ERROR - t=2025-05-30T08:19:13+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="authentication failed: Your account is limited to 1 simultaneous ngrok agent sessions.\nYou can run multiple simultaneous tunnels from a single agent session by defining the tunnels in your agent configuration file and starting them with the command `ngrok start --all`.\nRead more about the agent configuration file: https://ngrok.com/docs/secure-tunnels/ngrok-agent/reference/config\nYou can view your current agent sessions in the dashboard:\nhttps://dashboard.ngrok.com/agents\r\n\r\nERR_NGROK_108\r\n"
2025-05-30 08:19:15,691 - ERROR - t=2025-05-30T08:19:15+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="authentication failed: Your account is limited to 1 simultaneous ngrok agent sessions.\nYou can run multiple simultaneous tunnels from a single agent session by defining the tunnels in your agent configuration file and starting them with the command `ngrok start --all`.\nRead more about the agent configuration file: https://ngrok.com/docs/secure-tunnels/ngrok-agent/reference/config\nYou can view your current agent sessions in the dashboard:\nhttps://dashboard.ngrok.com/agents\r\n\r\nERR_NGROK_108\r\n"
2025-05-30 08:19:19,865 - ERROR - t=2025-05-30T08:19:19+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="authentication failed: Your account is limited to 1 simultaneous ngrok agent sessions.\nYou can run multiple simultaneous tunnels from a single agent session by defining the tunnels in your agent configuration file and starting them with the command `ngrok start --all`.\nRead more about the agent configuration file: https://ngrok.com/docs/secure-tunnels/ngrok-agent/reference/config\nYou can view your current agent sessions in the dashboard:\nhttps://dashboard.ngrok.com/agents\r\n\r\nERR_NGROK_108\r\n"
2025-05-30 08:19:28,235 - ERROR - t=2025-05-30T08:19:28+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="authentication failed: Your account is limited to 1 simultaneous ngrok agent sessions.\nYou can run multiple simultaneous tunnels from a single agent session by defining the tunnels in your agent configuration file and starting them with the command `ngrok start --all`.\nRead more about the agent configuration file: https://ngrok.com/docs/secure-tunnels/ngrok-agent/reference/config\nYou can view your current agent sessions in the dashboard:\nhttps://dashboard.ngrok.com/agents\r\n\r\nERR_NGROK_108\r\n"
2025-05-30 08:19:35,632 - ERROR - t=2025-05-30T08:19:35+0530 lvl=eror msg="heartbeat timeout, terminating session" obj=tunnels.session obj=csess id=88355c66e3ff clientid=821959a2bc35e7840da0741bc21ae116
2025-05-30 09:48:27,581 - ERROR - t=2025-05-30T09:48:27+0530 lvl=eror msg="heartbeat timeout, terminating session" obj=tunnels.session obj=csess id=fb2f59cfaa7c clientid=821959a2bc35e7840da0741bc21ae116
2025-05-30 09:48:27,675 - ERROR - t=2025-05-30T09:48:27+0530 lvl=eror msg="session closed, starting reconnect loop" obj=tunnels.session obj=csess id=e2ce6b75f2e6 err="session closed"
2025-05-30 09:48:27,691 - ERROR - t=2025-05-30T09:48:27+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="failed to dial ngrok server with address \"connect.ngrok-agent.com:443\": dial tcp: lookup connect.ngrok-agent.com: no such host"
2025-05-30 09:48:28,191 - ERROR - t=2025-05-30T09:48:28+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="failed to dial ngrok server with address \"connect.ngrok-agent.com:443\": dial tcp: lookup connect.ngrok-agent.com: no such host"
2025-05-30 11:36:51,512 - ERROR - t=2025-05-30T11:36:51+0530 lvl=eror msg="heartbeat timeout, terminating session" obj=tunnels.session obj=csess id=34a3efcc69dc clientid=821959a2bc35e7840da0741bc21ae116
2025-05-30 11:36:51,514 - ERROR - t=2025-05-30T11:36:51+0530 lvl=eror msg="session closed, starting reconnect loop" obj=tunnels.session obj=csess id=e2ce6b75f2e6 err="session closed"
2025-05-30 11:37:33,823 - ERROR - t=2025-05-30T11:37:33+0530 lvl=eror msg="session closed, starting reconnect loop" obj=tunnels.session obj=csess id=e2ce6b75f2e6 err="read tcp 192.168.1.15:54448->13.233.205.122:443: wsarecv: An established connection was aborted by the software in your host machine."
2025-05-30 11:37:34,433 - ERROR - t=2025-05-30T11:37:34+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="authentication failed: Your account is limited to 1 simultaneous ngrok agent sessions.\nYou can run multiple simultaneous tunnels from a single agent session by defining the tunnels in your agent configuration file and starting them with the command `ngrok start --all`.\nRead more about the agent configuration file: https://ngrok.com/docs/secure-tunnels/ngrok-agent/reference/config\nYou can view your current agent sessions in the dashboard:\nhttps://dashboard.ngrok.com/agents\r\n\r\nERR_NGROK_108\r\n"
2025-05-30 11:37:35,218 - ERROR - t=2025-05-30T11:37:35+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="authentication failed: Your account is limited to 1 simultaneous ngrok agent sessions.\nYou can run multiple simultaneous tunnels from a single agent session by defining the tunnels in your agent configuration file and starting them with the command `ngrok start --all`.\nRead more about the agent configuration file: https://ngrok.com/docs/secure-tunnels/ngrok-agent/reference/config\nYou can view your current agent sessions in the dashboard:\nhttps://dashboard.ngrok.com/agents\r\n\r\nERR_NGROK_108\r\n"
2025-05-30 11:37:36,412 - ERROR - t=2025-05-30T11:37:36+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="authentication failed: Your account is limited to 1 simultaneous ngrok agent sessions.\nYou can run multiple simultaneous tunnels from a single agent session by defining the tunnels in your agent configuration file and starting them with the command `ngrok start --all`.\nRead more about the agent configuration file: https://ngrok.com/docs/secure-tunnels/ngrok-agent/reference/config\nYou can view your current agent sessions in the dashboard:\nhttps://dashboard.ngrok.com/agents\r\n\r\nERR_NGROK_108\r\n"
2025-05-30 11:37:38,582 - ERROR - t=2025-05-30T11:37:38+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="authentication failed: Your account is limited to 1 simultaneous ngrok agent sessions.\nYou can run multiple simultaneous tunnels from a single agent session by defining the tunnels in your agent configuration file and starting them with the command `ngrok start --all`.\nRead more about the agent configuration file: https://ngrok.com/docs/secure-tunnels/ngrok-agent/reference/config\nYou can view your current agent sessions in the dashboard:\nhttps://dashboard.ngrok.com/agents\r\n\r\nERR_NGROK_108\r\n"
2025-05-30 11:37:42,785 - ERROR - t=2025-05-30T11:37:42+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="authentication failed: Your account is limited to 1 simultaneous ngrok agent sessions.\nYou can run multiple simultaneous tunnels from a single agent session by defining the tunnels in your agent configuration file and starting them with the command `ngrok start --all`.\nRead more about the agent configuration file: https://ngrok.com/docs/secure-tunnels/ngrok-agent/reference/config\nYou can view your current agent sessions in the dashboard:\nhttps://dashboard.ngrok.com/agents\r\n\r\nERR_NGROK_108\r\n"
2025-05-30 11:37:48,001 - ERROR - t=2025-05-30T11:37:48+0530 lvl=eror msg="heartbeat timeout, terminating session" obj=tunnels.session obj=csess id=e38ef36ae6de clientid=821959a2bc35e7840da0741bc21ae116
2025-05-30 12:36:20,585 - INFO - Shutting down
2025-05-30 12:36:20,693 - INFO - Waiting for application shutdown.
2025-05-30 12:36:20,695 - INFO - Shutting down server and ngrok tunnel...
2025-05-30 12:36:20,697 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-30 12:36:20,698 - INFO - Application shutdown complete.
2025-05-30 12:36:20,699 - INFO - Finished server process [31868]
2025-05-30 17:51:05,020 - INFO - Starting WhatsApp FastAPI app
2025-05-30 17:51:05,287 - INFO - Started server process [33184]
2025-05-30 17:51:05,289 - INFO - Waiting for application startup.
2025-05-30 17:51:06,891 - ERROR - Error in lifespan: ngrok client exception, API returned 502: {"error_code":103,"status_code":502,"msg":"failed to start tunnel","details":{"err":"failed to start tunnel: Custom subdomains are a feature on ngrok's paid plans.\nFailed to bind the custom subdomain 'ngrok-free.app' for the account 'rahul.filtero@gmail.com'.\nThis account is on the 'Free' plan.\n\nUpgrade to a paid plan at: https://dashboard.ngrok.com/billing/subscription\r\n\r\nERR_NGROK_313\r\n"}}
Traceback (most recent call last):
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\pyngrok\ngrok.py", line 557, in api_request
    response = urlopen(request, encoded_data, timeout)
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 189, in urlopen
    return opener.open(url, data, timeout)
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 495, in open
    response = meth(req, response)
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 604, in http_response
    response = self.parent.error(
        'http', request, response, code, msg, hdrs)
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 533, in error
    return self._call_chain(*args)
           ~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 466, in _call_chain
    result = func(*args)
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 613, in http_error_default
    raise HTTPError(req.full_url, code, msg, hdrs, fp)
urllib.error.HTTPError: HTTP Error 502: Bad Gateway

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 74, in lifespan
    http_tunnel = ngrok.connect(5001, proto="http", hostname="whatsapp-bot.ngrok-free.app")
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\pyngrok\ngrok.py", line 355, in connect
    tunnel = NgrokTunnel(api_request(f"{api_url}/api/tunnels", method="POST", data=options,
                         ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                     timeout=pyngrok_config.request_timeout),
                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\pyngrok\ngrok.py", line 578, in api_request
    raise PyngrokNgrokHTTPError(f"ngrok client exception, API returned {status_code}: {response_data}",
                                e.url,
                                status_code, e.reason, e.headers, response_data)
pyngrok.exception.PyngrokNgrokHTTPError: ngrok client exception, API returned 502: {"error_code":103,"status_code":502,"msg":"failed to start tunnel","details":{"err":"failed to start tunnel: Custom subdomains are a feature on ngrok's paid plans.\nFailed to bind the custom subdomain 'ngrok-free.app' for the account 'rahul.filtero@gmail.com'.\nThis account is on the 'Free' plan.\n\nUpgrade to a paid plan at: https://dashboard.ngrok.com/billing/subscription\r\n\r\nERR_NGROK_313\r\n"}}

2025-05-30 17:51:06,922 - ERROR - Traceback (most recent call last):
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\pyngrok\ngrok.py", line 557, in api_request
    response = urlopen(request, encoded_data, timeout)
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 189, in urlopen
    return opener.open(url, data, timeout)
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 495, in open
    response = meth(req, response)
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 604, in http_response
    response = self.parent.error(
        'http', request, response, code, msg, hdrs)
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 533, in error
    return self._call_chain(*args)
           ~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 466, in _call_chain
    result = func(*args)
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 613, in http_error_default
    raise HTTPError(req.full_url, code, msg, hdrs, fp)
urllib.error.HTTPError: HTTP Error 502: Bad Gateway

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 74, in lifespan
    http_tunnel = ngrok.connect(5001, proto="http", hostname="whatsapp-bot.ngrok-free.app")
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\pyngrok\ngrok.py", line 355, in connect
    tunnel = NgrokTunnel(api_request(f"{api_url}/api/tunnels", method="POST", data=options,
                         ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                     timeout=pyngrok_config.request_timeout),
                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\pyngrok\ngrok.py", line 578, in api_request
    raise PyngrokNgrokHTTPError(f"ngrok client exception, API returned {status_code}: {response_data}",
                                e.url,
                                status_code, e.reason, e.headers, response_data)
pyngrok.exception.PyngrokNgrokHTTPError: ngrok client exception, API returned 502: {"error_code":103,"status_code":502,"msg":"failed to start tunnel","details":{"err":"failed to start tunnel: Custom subdomains are a feature on ngrok's paid plans.\nFailed to bind the custom subdomain 'ngrok-free.app' for the account 'rahul.filtero@gmail.com'.\nThis account is on the 'Free' plan.\n\nUpgrade to a paid plan at: https://dashboard.ngrok.com/billing/subscription\r\n\r\nERR_NGROK_313\r\n"}}


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 693, in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 105, in lifespan
    sys.exit(1)
    ~~~~~~~~^^^
SystemExit: 1

2025-05-30 17:51:06,935 - ERROR - Application startup failed. Exiting.
2025-05-30 17:51:46,623 - INFO - Starting WhatsApp FastAPI app
2025-05-30 17:51:46,754 - INFO - Started server process [20080]
2025-05-30 17:51:46,755 - INFO - Waiting for application startup.
2025-05-30 17:51:47,082 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-30 17:51:47,094 - INFO - Starting the FastAPI app with lifespan.
2025-05-30 17:51:47,094 - INFO - Application startup complete.
2025-05-30 17:51:47,095 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-30 18:15:11,568 - INFO - User 919530251797 found in MongoDB and cached in Redis.
2025-05-30 18:15:11,569 - INFO - Received message from 919530251797: Hi
2025-05-30 18:15:11,570 - INFO - 2a03:2880:22ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 18:15:11,571 - INFO - Started message processing for user 919530251797
2025-05-30 18:15:14,574 - INFO - Processing batched messages for 919530251797: Hi
2025-05-30 18:15:17,966 - ERROR - Error sending message to user 919530251797: {'error': {'message': 'Error validating access token: Session has expired on Thursday, 29-May-25 00:00:00 PDT. The current time is Friday, 30-May-25 05:45:18 PDT.', 'type': 'OAuthException', 'code': 190, 'error_subcode': 463, 'fbtrace_id': 'AWBIX1IirEQERMeAk0kHTFa'}} (Status Code: 401)
2025-05-30 18:15:17,968 - ERROR - NoneType: None

2025-05-30 18:15:17,969 - INFO - Sent response to user 919530251797, seq 1.
2025-05-30 18:17:44,591 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-05-30 18:17:44,591 - INFO - Cleaned up processing task for user 919530251797.
2025-05-30 20:02:37,016 - INFO - Shutting down
2025-05-30 20:02:37,127 - INFO - Waiting for application shutdown.
2025-05-30 20:02:37,127 - INFO - Shutting down server and ngrok tunnel...
2025-05-30 20:02:37,196 - INFO - Lifespan shutdown: Backed up unique users.
2025-05-30 20:02:37,197 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-30 20:02:37,198 - INFO - Application shutdown complete.
2025-05-30 20:02:37,199 - INFO - Finished server process [20080]
2025-05-30 20:02:52,342 - INFO - Starting WhatsApp FastAPI app
2025-05-30 20:02:52,449 - INFO - Started server process [6156]
2025-05-30 20:02:52,450 - INFO - Waiting for application startup.
2025-05-30 20:02:52,997 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-30 20:02:53,007 - INFO - Starting the FastAPI app with lifespan.
2025-05-30 20:02:53,008 - INFO - Application startup complete.
2025-05-30 20:02:53,009 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-30 20:02:59,869 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:02:59,870 - INFO - Received message from 919530251797: Hi
2025-05-30 20:02:59,870 - INFO - 2a03:2880:21ff:4c:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:02:59,871 - INFO - Started message processing for user 919530251797
2025-05-30 20:03:02,887 - INFO - Processing batched messages for 919530251797: Hi
2025-05-30 20:03:07,437 - INFO - Sent response to user 919530251797, seq 1.
2025-05-30 20:03:08,425 - WARNING - Webhook payload does not include a phone number.
2025-05-30 20:03:08,425 - INFO - 2a03:2880:22ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:03:08,921 - WARNING - Webhook payload does not include a phone number.
2025-05-30 20:03:08,921 - INFO - 2a03:2880:10ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:03:23,064 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:03:23,064 - INFO - Received message from 919530251797: I need discounts
2025-05-30 20:03:23,065 - INFO - 2a03:2880:10ff:56:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:03:23,065 - INFO - Message queued for user 919530251797 - processing already active
2025-05-30 20:03:26,070 - INFO - Processing batched messages for 919530251797: I need discounts
2025-05-30 20:03:29,029 - ERROR - Error sending quick replies to user 919530251797: {'error': {'message': '(#131009) Parameter value is not valid', 'type': 'OAuthException', 'code': 131009, 'error_data': {'messaging_product': 'whatsapp', 'details': 'Invalid buttons count. Min allowed buttons: 1, Max allowed buttons: 3'}, 'fbtrace_id': 'AYMfgqByA_H5f4TWz8io274'}} (Status Code: 400)
2025-05-30 20:03:29,030 - ERROR - NoneType: None

2025-05-30 20:03:29,034 - INFO - Sent response to user 919530251797, seq 2.
2025-05-30 20:05:56,084 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-05-30 20:05:56,086 - INFO - Cleaned up processing task for user 919530251797.
2025-05-30 20:09:28,075 - INFO - Shutting down
2025-05-30 20:09:28,184 - INFO - Waiting for application shutdown.
2025-05-30 20:09:28,184 - INFO - Shutting down server and ngrok tunnel...
2025-05-30 20:09:28,234 - INFO - Lifespan shutdown: Backed up unique users.
2025-05-30 20:09:28,234 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-30 20:09:28,234 - INFO - Application shutdown complete.
2025-05-30 20:09:28,235 - INFO - Finished server process [6156]
2025-05-30 20:09:40,567 - INFO - Starting WhatsApp FastAPI app
2025-05-30 20:09:40,689 - INFO - Started server process [21800]
2025-05-30 20:09:40,690 - INFO - Waiting for application startup.
2025-05-30 20:09:41,274 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-30 20:09:41,279 - INFO - Starting the FastAPI app with lifespan.
2025-05-30 20:09:41,279 - INFO - Application startup complete.
2025-05-30 20:09:41,280 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-30 20:10:00,928 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:10:00,929 - INFO - Received message from 919530251797: I need discounts
2025-05-30 20:10:00,929 - INFO - 2a03:2880:22ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:10:00,930 - INFO - Started message processing for user 919530251797
2025-05-30 20:10:03,943 - INFO - Processing batched messages for 919530251797: I need discounts
2025-05-30 20:10:07,819 - INFO - Sent response to user 919530251797, seq 1.
2025-05-30 20:10:08,960 - WARNING - Webhook payload does not include a phone number.
2025-05-30 20:10:08,961 - INFO - 2a03:2880:22ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:10:09,096 - WARNING - Webhook payload does not include a phone number.
2025-05-30 20:10:09,097 - INFO - 2a03:2880:21ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:10:22,033 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:10:22,033 - INFO - 2a03:2880:21ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:10:48,942 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:10:48,943 - INFO - 2a03:2880:10ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:12:33,945 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-05-30 20:12:33,946 - INFO - Cleaned up processing task for user 919530251797.
2025-05-30 20:12:48,558 - INFO - Shutting down
2025-05-30 20:12:48,666 - INFO - Waiting for application shutdown.
2025-05-30 20:12:48,666 - INFO - Shutting down server and ngrok tunnel...
2025-05-30 20:12:48,717 - INFO - Lifespan shutdown: Backed up unique users.
2025-05-30 20:12:48,718 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-30 20:12:48,718 - INFO - Application shutdown complete.
2025-05-30 20:12:48,718 - INFO - Finished server process [21800]
2025-05-30 20:13:00,360 - INFO - Starting WhatsApp FastAPI app
2025-05-30 20:13:00,460 - INFO - Started server process [25520]
2025-05-30 20:13:00,461 - INFO - Waiting for application startup.
2025-05-30 20:13:00,946 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-30 20:13:00,953 - INFO - Starting the FastAPI app with lifespan.
2025-05-30 20:13:00,953 - INFO - Application startup complete.
2025-05-30 20:13:00,954 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-30 20:13:09,785 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:13:09,826 - ERROR - Error processing webhook payload: cannot access local variable 'message_text' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 327, in process_webhook_payload
    conversation_history.append({"role": "user", "content": message_text})
                                                            ^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'message_text' where it is not associated with a value
2025-05-30 20:13:09,829 - ERROR - Error processing webhook: cannot access local variable 'message_text' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 386, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 327, in process_webhook_payload
    conversation_history.append({"role": "user", "content": message_text})
                                                            ^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'message_text' where it is not associated with a value
2025-05-30 20:13:09,831 - INFO - 2a03:2880:10ff:7c:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:13:10,583 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:13:10,624 - ERROR - Error processing webhook payload: cannot access local variable 'message_text' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 327, in process_webhook_payload
    conversation_history.append({"role": "user", "content": message_text})
                                                            ^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'message_text' where it is not associated with a value
2025-05-30 20:13:10,627 - ERROR - Error processing webhook: cannot access local variable 'message_text' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 386, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 327, in process_webhook_payload
    conversation_history.append({"role": "user", "content": message_text})
                                                            ^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'message_text' where it is not associated with a value
2025-05-30 20:13:10,629 - INFO - 2a03:2880:22ff:71:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:13:11,451 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:13:11,493 - ERROR - Error processing webhook payload: cannot access local variable 'message_text' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 327, in process_webhook_payload
    conversation_history.append({"role": "user", "content": message_text})
                                                            ^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'message_text' where it is not associated with a value
2025-05-30 20:13:11,495 - ERROR - Error processing webhook: cannot access local variable 'message_text' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 386, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 327, in process_webhook_payload
    conversation_history.append({"role": "user", "content": message_text})
                                                            ^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'message_text' where it is not associated with a value
2025-05-30 20:13:11,497 - INFO - 2a03:2880:21ff:4c:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:13:13,602 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:13:13,644 - ERROR - Error processing webhook payload: cannot access local variable 'message_text' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 327, in process_webhook_payload
    conversation_history.append({"role": "user", "content": message_text})
                                                            ^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'message_text' where it is not associated with a value
2025-05-30 20:13:13,645 - ERROR - Error processing webhook: cannot access local variable 'message_text' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 386, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 327, in process_webhook_payload
    conversation_history.append({"role": "user", "content": message_text})
                                                            ^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'message_text' where it is not associated with a value
2025-05-30 20:13:13,647 - INFO - 2a03:2880:21ff:43:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:13:37,750 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:13:37,792 - ERROR - Error processing webhook payload: cannot access local variable 'message_text' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 327, in process_webhook_payload
    conversation_history.append({"role": "user", "content": message_text})
                                                            ^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'message_text' where it is not associated with a value
2025-05-30 20:13:37,793 - ERROR - Error processing webhook: cannot access local variable 'message_text' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 386, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 327, in process_webhook_payload
    conversation_history.append({"role": "user", "content": message_text})
                                                            ^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'message_text' where it is not associated with a value
2025-05-30 20:13:37,797 - INFO - 2a03:2880:22ff:74:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:14:37,422 - INFO - Shutting down
2025-05-30 20:14:37,533 - INFO - Waiting for application shutdown.
2025-05-30 20:14:37,534 - INFO - Shutting down server and ngrok tunnel...
2025-05-30 20:14:37,578 - INFO - Lifespan shutdown: Backed up unique users.
2025-05-30 20:14:37,578 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-30 20:14:37,579 - INFO - Application shutdown complete.
2025-05-30 20:14:37,580 - INFO - Finished server process [25520]
2025-05-30 20:14:51,472 - INFO - Starting WhatsApp FastAPI app
2025-05-30 20:14:51,579 - INFO - Started server process [27604]
2025-05-30 20:14:51,580 - INFO - Waiting for application startup.
2025-05-30 20:14:52,066 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-30 20:14:52,072 - INFO - Starting the FastAPI app with lifespan.
2025-05-30 20:14:52,072 - INFO - Application startup complete.
2025-05-30 20:14:52,073 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-30 20:15:04,419 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:15:05,727 - INFO - 2a03:2880:12ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:15:07,395 - WARNING - Webhook payload does not include a phone number.
2025-05-30 20:15:07,395 - INFO - 2a03:2880:22ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:15:07,661 - WARNING - Webhook payload does not include a phone number.
2025-05-30 20:15:07,662 - INFO - 2a03:2880:21ff:4c:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:15:07,770 - WARNING - Webhook payload does not include a phone number.
2025-05-30 20:15:07,771 - INFO - 2a03:2880:10ff:4f:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:16:04,487 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:16:04,487 - INFO - Received image from 919530251797
2025-05-30 20:16:04,488 - INFO - 2a03:2880:10ff:51:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:20:47,072 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:20:48,135 - INFO - 2a03:2880:22ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:20:49,312 - WARNING - Webhook payload does not include a phone number.
2025-05-30 20:20:49,313 - INFO - 2a03:2880:22ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:20:49,352 - WARNING - Webhook payload does not include a phone number.
2025-05-30 20:20:49,352 - INFO - 2a03:2880:12ff:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:21:24,654 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:21:25,670 - INFO - 2a03:2880:21ff:46:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:21:26,744 - WARNING - Webhook payload does not include a phone number.
2025-05-30 20:21:26,745 - INFO - 2a03:2880:10ff:43:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:21:26,862 - WARNING - Webhook payload does not include a phone number.
2025-05-30 20:21:26,863 - INFO - 2a03:2880:21ff:47:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:21:26,990 - WARNING - Webhook payload does not include a phone number.
2025-05-30 20:21:26,990 - INFO - 2a03:2880:22ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:38:09,850 - INFO - Shutting down
2025-05-30 20:38:09,959 - INFO - Waiting for application shutdown.
2025-05-30 20:38:09,960 - INFO - Shutting down server and ngrok tunnel...
2025-05-30 20:38:10,007 - INFO - Lifespan shutdown: Backed up unique users.
2025-05-30 20:38:10,007 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-30 20:38:10,007 - INFO - Application shutdown complete.
2025-05-30 20:38:10,007 - INFO - Finished server process [27604]
2025-05-30 20:38:23,312 - INFO - Starting WhatsApp FastAPI app
2025-05-30 20:38:23,444 - INFO - Started server process [18440]
2025-05-30 20:38:23,445 - INFO - Waiting for application startup.
2025-05-30 20:38:23,989 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-30 20:38:23,995 - INFO - Starting the FastAPI app with lifespan.
2025-05-30 20:38:23,995 - INFO - Application startup complete.
2025-05-30 20:38:23,996 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-30 20:38:36,401 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:38:36,401 - INFO - Received image from 919530251797
2025-05-30 20:38:36,705 - ERROR - Error processing webhook payload: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 337, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
2025-05-30 20:38:36,723 - ERROR - Error processing webhook: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 382, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 337, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
2025-05-30 20:38:36,726 - INFO - 2a03:2880:10ff:73:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:38:37,501 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:38:37,502 - INFO - Received image from 919530251797
2025-05-30 20:38:37,800 - ERROR - Error processing webhook payload: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 337, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
2025-05-30 20:38:37,804 - ERROR - Error processing webhook: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 382, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 337, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
2025-05-30 20:38:37,807 - INFO - 2a03:2880:21ff:73:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:38:38,595 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:38:38,596 - INFO - Received image from 919530251797
2025-05-30 20:38:38,872 - ERROR - Error processing webhook payload: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 337, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
2025-05-30 20:38:38,875 - ERROR - Error processing webhook: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 382, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 337, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
2025-05-30 20:38:38,878 - INFO - 2a03:2880:21ff:c:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:38:41,245 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:38:41,246 - INFO - Received image from 919530251797
2025-05-30 20:38:41,552 - ERROR - Error processing webhook payload: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 337, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
2025-05-30 20:38:41,556 - ERROR - Error processing webhook: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 382, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 337, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
2025-05-30 20:38:41,559 - INFO - 2a03:2880:21ff:3:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:39:07,037 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:39:07,037 - INFO - Received image from 919530251797
2025-05-30 20:39:07,328 - ERROR - Error processing webhook payload: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 337, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
2025-05-30 20:39:07,331 - ERROR - Error processing webhook: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 382, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 337, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/22.0/1739965490252603
2025-05-30 20:39:07,333 - INFO - 2a03:2880:22ff:9:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:39:58,672 - INFO - Shutting down
2025-05-30 20:39:58,780 - INFO - Waiting for application shutdown.
2025-05-30 20:39:58,781 - INFO - Shutting down server and ngrok tunnel...
2025-05-30 20:39:58,822 - INFO - Lifespan shutdown: Backed up unique users.
2025-05-30 20:39:58,823 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-30 20:39:58,823 - INFO - Application shutdown complete.
2025-05-30 20:39:58,823 - INFO - Finished server process [18440]
2025-05-30 20:40:10,812 - INFO - Starting WhatsApp FastAPI app
2025-05-30 20:40:10,941 - INFO - Started server process [17100]
2025-05-30 20:40:10,942 - INFO - Waiting for application startup.
2025-05-30 20:40:11,501 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-30 20:40:11,507 - INFO - Starting the FastAPI app with lifespan.
2025-05-30 20:40:11,508 - INFO - Application startup complete.
2025-05-30 20:40:11,508 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-30 20:40:47,554 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:40:47,554 - INFO - Received image from 919530251797
2025-05-30 20:40:48,605 - ERROR - Error in download_whatsapp_media: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
2025-05-30 20:40:48,607 - ERROR - Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017

2025-05-30 20:40:48,609 - ERROR - Error processing webhook payload: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
2025-05-30 20:40:48,612 - ERROR - Error processing webhook: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 382, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
2025-05-30 20:40:48,616 - INFO - 2a03:2880:21ff:4c:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:40:49,613 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:40:49,614 - INFO - Received image from 919530251797
2025-05-30 20:40:51,865 - ERROR - Error in download_whatsapp_media: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
2025-05-30 20:40:51,866 - ERROR - Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017

2025-05-30 20:40:51,868 - ERROR - Error processing webhook payload: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
2025-05-30 20:40:51,871 - ERROR - Error processing webhook: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 382, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
2025-05-30 20:40:51,875 - INFO - 2a03:2880:12ff:2:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:40:52,884 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:40:52,884 - INFO - Received image from 919530251797
2025-05-30 20:40:53,952 - ERROR - Error in download_whatsapp_media: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
2025-05-30 20:40:53,953 - ERROR - Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017

2025-05-30 20:40:53,955 - ERROR - Error processing webhook payload: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
2025-05-30 20:40:53,959 - ERROR - Error processing webhook: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 382, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
2025-05-30 20:40:53,962 - INFO - 2a03:2880:12ff:8:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:40:56,337 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:40:56,338 - INFO - Received image from 919530251797
2025-05-30 20:40:59,555 - ERROR - Error in download_whatsapp_media: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
2025-05-30 20:40:59,556 - ERROR - Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017

2025-05-30 20:40:59,558 - ERROR - Error processing webhook payload: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
2025-05-30 20:40:59,561 - ERROR - Error processing webhook: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 382, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
2025-05-30 20:40:59,564 - INFO - 2a03:2880:12ff:8:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:41:27,501 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:41:27,502 - INFO - Received image from 919530251797
2025-05-30 20:41:29,412 - ERROR - Error in download_whatsapp_media: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
2025-05-30 20:41:29,414 - ERROR - Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017

2025-05-30 20:41:29,415 - ERROR - Error processing webhook payload: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
2025-05-30 20:41:29,418 - ERROR - Error processing webhook: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 382, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1068064081891017
2025-05-30 20:41:29,421 - INFO - 2a03:2880:12ff:7c:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:46:04,857 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:46:04,857 - INFO - Received image from 919530251797
2025-05-30 20:46:05,164 - ERROR - Error in download_whatsapp_media: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1739965490252603
2025-05-30 20:46:05,166 - ERROR - Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1739965490252603

2025-05-30 20:46:05,168 - ERROR - Error processing webhook payload: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1739965490252603
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1739965490252603
2025-05-30 20:46:05,171 - ERROR - Error processing webhook: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1739965490252603
Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 382, in handle_webhook
    await process_webhook_payload(data)
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 341, in process_webhook_payload
    media_resp, content_type = await download_whatsapp_media(media_id)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_api.py", line 338, in download_whatsapp_media
    media_url_resp.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/651244058075225/media/1739965490252603
2025-05-30 20:46:05,174 - INFO - 2a03:2880:22ff:7e:::0 - "POST /webhook HTTP/1.1" 500
2025-05-30 20:46:08,252 - INFO - Shutting down
2025-05-30 20:46:08,362 - INFO - Waiting for application shutdown.
2025-05-30 20:46:08,362 - INFO - Shutting down server and ngrok tunnel...
2025-05-30 20:46:08,407 - INFO - Lifespan shutdown: Backed up unique users.
2025-05-30 20:46:08,408 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-30 20:46:08,409 - INFO - Application shutdown complete.
2025-05-30 20:46:08,409 - INFO - Finished server process [17100]
2025-05-30 20:47:57,390 - INFO - Starting WhatsApp FastAPI app
2025-05-30 20:47:57,510 - INFO - Started server process [26372]
2025-05-30 20:47:57,511 - INFO - Waiting for application startup.
2025-05-30 20:47:58,133 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-30 20:47:58,138 - INFO - Starting the FastAPI app with lifespan.
2025-05-30 20:47:58,138 - INFO - Application startup complete.
2025-05-30 20:47:58,139 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-30 20:48:07,422 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:48:07,422 - INFO - Received image from 919530251797
2025-05-30 20:48:07,423 - INFO - Uploaded media to GCS: <coroutine object process_whatsapp_media_payload at 0x0000026E95050D40>
2025-05-30 20:48:07,424 - INFO - 2a03:2880:12ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:48:07,849 - INFO - User 919530251797 found in Redis cache.
2025-05-30 20:48:07,850 - INFO - Received image from 919530251797
2025-05-30 20:48:07,851 - INFO - Uploaded media to GCS: <coroutine object process_whatsapp_media_payload at 0x0000026E95050D40>
2025-05-30 20:48:07,851 - INFO - 2a03:2880:10ff:56:::0 - "POST /webhook HTTP/1.1" 200
2025-05-30 20:49:13,619 - INFO - Shutting down
2025-05-30 20:49:13,728 - INFO - Waiting for application shutdown.
2025-05-30 20:49:13,729 - INFO - Shutting down server and ngrok tunnel...
2025-05-30 20:49:13,777 - INFO - Lifespan shutdown: Backed up unique users.
2025-05-30 20:49:13,778 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-30 20:49:13,778 - INFO - Application shutdown complete.
2025-05-30 20:49:13,778 - INFO - Finished server process [26372]
2025-05-31 13:19:02,270 - INFO - Starting WhatsApp FastAPI app
2025-05-31 13:19:02,484 - INFO - Started server process [8712]
2025-05-31 13:19:02,485 - INFO - Waiting for application startup.
2025-05-31 13:19:04,794 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-31 13:19:04,909 - INFO - Starting the FastAPI app with lifespan.
2025-05-31 13:19:04,909 - INFO - Application startup complete.
2025-05-31 13:19:04,910 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-31 13:19:10,813 - INFO - Inserted new user in DB: 919530251797
2025-05-31 13:19:10,858 - INFO - Received message from 919530251797: Hi
2025-05-31 13:19:10,859 - INFO - 2a03:2880:10ff:45:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 13:19:10,861 - INFO - Started message processing for user 919530251797
2025-05-31 13:19:13,875 - INFO - Processing batched messages for 919530251797: Hi
2025-05-31 13:19:17,322 - ERROR - Error sending message to user 919530251797: {'error': {'message': 'Error validating access token: Session has expired on Friday, 30-May-25 09:00:00 PDT. The current time is Saturday, 31-May-25 00:49:17 PDT.', 'type': 'OAuthException', 'code': 190, 'error_subcode': 463, 'fbtrace_id': 'AqKWG8Gt_z56HFD9XG40dvY'}} (Status Code: 401)
2025-05-31 13:19:17,324 - ERROR - NoneType: None

2025-05-31 13:19:17,326 - INFO - Sent response to user 919530251797, seq 1.
2025-05-31 13:21:43,876 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-05-31 13:21:43,876 - INFO - Cleaned up processing task for user 919530251797.
2025-05-31 13:24:36,875 - INFO - Shutting down
2025-05-31 13:24:36,985 - INFO - Waiting for application shutdown.
2025-05-31 13:24:36,987 - INFO - Shutting down server and ngrok tunnel...
2025-05-31 13:24:37,049 - INFO - Lifespan shutdown: Backed up unique users.
2025-05-31 13:24:37,050 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-31 13:24:37,051 - INFO - Application shutdown complete.
2025-05-31 13:24:37,052 - INFO - Finished server process [8712]
2025-05-31 17:31:38,147 - INFO - Starting WhatsApp FastAPI app
2025-05-31 17:31:38,312 - INFO - Started server process [29128]
2025-05-31 17:31:38,313 - INFO - Waiting for application startup.
2025-05-31 17:31:39,547 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-31 17:31:39,660 - INFO - Starting the FastAPI app with lifespan.
2025-05-31 17:31:39,661 - INFO - Application startup complete.
2025-05-31 17:31:39,661 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-31 17:31:56,638 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:31:56,639 - INFO - Received message from 919530251797: Hello whatsapp what r u doing
2025-05-31 17:31:56,639 - INFO - 2a03:2880:10ff:a:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:31:56,641 - INFO - Started message processing for user 919530251797
2025-05-31 17:31:59,656 - INFO - Processing batched messages for 919530251797: Hello whatsapp what r u doing
2025-05-31 17:32:04,458 - INFO - Sent response to user 919530251797, seq 1.
2025-05-31 17:32:05,492 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:32:05,493 - INFO - 2a03:2880:10ff:e:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:32:05,700 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:32:05,701 - INFO - 2a03:2880:10ff:45:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:32:05,737 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:32:05,738 - INFO - 2a03:2880:22ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:32:19,409 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:32:19,409 - INFO - Received message from 919530251797: 6months more
2025-05-31 17:32:19,409 - INFO - 2a03:2880:10ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:32:19,410 - INFO - Message queued for user 919530251797 - processing already active
2025-05-31 17:32:22,423 - INFO - Processing batched messages for 919530251797: 6months more
2025-05-31 17:32:24,831 - INFO - Sent response to user 919530251797, seq 2.
2025-05-31 17:32:26,167 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:32:26,168 - INFO - 2a03:2880:22ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:32:26,199 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:32:26,200 - INFO - 2a03:2880:22ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:32:26,634 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:32:26,635 - INFO - 2a03:2880:12ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:34:00,661 - INFO - Shutting down
2025-05-31 17:34:00,771 - INFO - Waiting for application shutdown.
2025-05-31 17:34:00,772 - INFO - Shutting down server and ngrok tunnel...
2025-05-31 17:34:00,822 - INFO - Lifespan shutdown: Backed up unique users.
2025-05-31 17:34:00,823 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-31 17:34:00,824 - INFO - Application shutdown complete.
2025-05-31 17:34:00,824 - INFO - Finished server process [29128]
2025-05-31 17:34:00,825 - INFO - Processing task for user 919530251797 was cancelled.
2025-05-31 17:34:00,825 - INFO - Cleaned up processing task for user 919530251797.
2025-05-31 17:37:40,193 - INFO - Starting WhatsApp FastAPI app
2025-05-31 17:37:40,309 - INFO - Started server process [25468]
2025-05-31 17:37:40,311 - INFO - Waiting for application startup.
2025-05-31 17:37:41,135 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-31 17:37:41,147 - INFO - Starting the FastAPI app with lifespan.
2025-05-31 17:37:41,148 - INFO - Application startup complete.
2025-05-31 17:37:41,149 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-31 17:37:54,710 - INFO - Inserted new user in DB: 919530251797
2025-05-31 17:37:54,717 - INFO - Received message from 919530251797: Hi
2025-05-31 17:37:54,718 - INFO - 2a03:2880:21ff:46:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:37:54,719 - INFO - Started message processing for user 919530251797
2025-05-31 17:37:57,731 - INFO - Processing batched messages for 919530251797: Hi
2025-05-31 17:38:01,395 - INFO - Sent response to user 919530251797, seq 1.
2025-05-31 17:38:02,640 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:38:02,640 - INFO - 2a03:2880:12ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:38:02,694 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:38:02,694 - INFO - 2a03:2880:10ff:4d:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:38:02,897 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:38:02,897 - INFO - 2a03:2880:12ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:38:17,590 - INFO - Shutting down
2025-05-31 17:38:17,699 - INFO - Waiting for application shutdown.
2025-05-31 17:38:17,699 - INFO - Shutting down server and ngrok tunnel...
2025-05-31 17:38:17,745 - INFO - Lifespan shutdown: Backed up unique users.
2025-05-31 17:38:17,745 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-31 17:38:17,746 - INFO - Application shutdown complete.
2025-05-31 17:38:17,746 - INFO - Finished server process [25468]
2025-05-31 17:38:17,747 - INFO - Processing task for user 919530251797 was cancelled.
2025-05-31 17:38:17,747 - INFO - Cleaned up processing task for user 919530251797.
2025-05-31 17:39:02,960 - INFO - Starting WhatsApp FastAPI app
2025-05-31 17:39:03,078 - INFO - Started server process [22456]
2025-05-31 17:39:03,079 - INFO - Waiting for application startup.
2025-05-31 17:39:03,930 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-31 17:39:03,938 - INFO - Starting the FastAPI app with lifespan.
2025-05-31 17:39:03,939 - INFO - Application startup complete.
2025-05-31 17:39:03,939 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-31 17:39:18,003 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:39:18,004 - INFO - Received message from 919530251797: Hello
2025-05-31 17:39:18,004 - INFO - 2a03:2880:22ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:39:18,005 - INFO - Started message processing for user 919530251797
2025-05-31 17:39:21,021 - INFO - Processing batched messages for 919530251797: Hello
2025-05-31 17:39:24,941 - INFO - Sent response to user 919530251797, seq 1.
2025-05-31 17:39:25,995 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:39:25,995 - INFO - 2a03:2880:10ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:39:26,177 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:39:26,178 - INFO - 2a03:2880:10ff:54:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:39:26,327 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:39:26,327 - INFO - 2a03:2880:12ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:39:27,456 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:39:27,457 - INFO - Received message from 919530251797: Hello
2025-05-31 17:39:27,457 - INFO - 2a03:2880:21ff:55:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:39:27,458 - INFO - Message queued for user 919530251797 - processing already active
2025-05-31 17:39:30,471 - INFO - Processing batched messages for 919530251797: Hello
2025-05-31 17:39:32,618 - INFO - Sent response to user 919530251797, seq 2.
2025-05-31 17:39:33,675 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:39:33,676 - INFO - 2a03:2880:10ff:d:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:39:33,822 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:39:33,822 - INFO - 2a03:2880:10ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:39:33,866 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:39:33,867 - INFO - 2a03:2880:22ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:39:40,037 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:39:40,037 - INFO - Received message from 919530251797: Whom i m talking to
2025-05-31 17:39:40,037 - INFO - 2a03:2880:21ff:44:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:39:40,038 - INFO - Message queued for user 919530251797 - processing already active
2025-05-31 17:39:43,046 - INFO - Processing batched messages for 919530251797: Whom i m talking to
2025-05-31 17:39:44,984 - INFO - Sent response to user 919530251797, seq 3.
2025-05-31 17:39:45,951 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:39:45,952 - INFO - 2a03:2880:22ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:39:46,152 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:39:46,152 - INFO - 2a03:2880:22ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:40:17,801 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:40:17,802 - INFO - Received message from 919530251797: Are u ai bot right don't lie or i will kill myself
2025-05-31 17:40:17,802 - INFO - 2a03:2880:22ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:40:17,803 - INFO - Message queued for user 919530251797 - processing already active
2025-05-31 17:40:20,810 - INFO - Processing batched messages for 919530251797: Are u ai bot right don't lie or i will kill myself
2025-05-31 17:40:23,709 - INFO - Sent response to user 919530251797, seq 4.
2025-05-31 17:40:24,671 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:40:24,671 - INFO - 2a03:2880:22ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:40:24,788 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:40:24,789 - INFO - 2a03:2880:10ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:40:25,035 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:40:25,035 - INFO - 2a03:2880:22ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:40:42,422 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:40:42,422 - INFO - Received message from 919530251797: How long u have been working
2025-05-31 17:40:42,422 - INFO - 2a03:2880:21ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:40:42,423 - INFO - Message queued for user 919530251797 - processing already active
2025-05-31 17:40:45,438 - INFO - Processing batched messages for 919530251797: How long u have been working
2025-05-31 17:40:48,187 - INFO - Sent response to user 919530251797, seq 5.
2025-05-31 17:40:49,215 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:40:49,215 - INFO - 2a03:2880:10ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:40:49,360 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:40:49,360 - INFO - 2a03:2880:22ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:40:49,472 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:40:49,472 - INFO - 2a03:2880:10ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:41:01,392 - INFO - Shutting down
2025-05-31 17:41:01,502 - INFO - Waiting for application shutdown.
2025-05-31 17:41:01,502 - INFO - Shutting down server and ngrok tunnel...
2025-05-31 17:41:01,540 - INFO - Lifespan shutdown: Backed up unique users.
2025-05-31 17:41:01,540 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-31 17:41:01,541 - INFO - Application shutdown complete.
2025-05-31 17:41:01,541 - INFO - Finished server process [22456]
2025-05-31 17:41:01,542 - INFO - Processing task for user 919530251797 was cancelled.
2025-05-31 17:41:01,542 - INFO - Cleaned up processing task for user 919530251797.
2025-05-31 17:41:50,670 - INFO - Starting WhatsApp FastAPI app
2025-05-31 17:41:50,779 - INFO - Started server process [30632]
2025-05-31 17:41:50,780 - INFO - Waiting for application startup.
2025-05-31 17:41:51,584 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-31 17:41:51,589 - INFO - Starting the FastAPI app with lifespan.
2025-05-31 17:41:51,589 - INFO - Application startup complete.
2025-05-31 17:41:51,590 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-31 17:42:09,759 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:42:09,759 - INFO - Received message from 919530251797: 6months mor
2025-05-31 17:42:09,760 - INFO - 2a03:2880:22ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:42:09,760 - INFO - Started message processing for user 919530251797
2025-05-31 17:42:12,768 - INFO - Processing batched messages for 919530251797: 6months mor
2025-05-31 17:42:16,726 - INFO - Sent response to user 919530251797, seq 1.
2025-05-31 17:42:17,791 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:42:17,791 - INFO - 2a03:2880:21ff:48:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:42:17,894 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:42:17,895 - INFO - 2a03:2880:22ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:44:42,784 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-05-31 17:44:42,784 - INFO - Cleaned up processing task for user 919530251797.
2025-05-31 17:45:17,182 - INFO - Shutting down
2025-05-31 17:45:17,293 - INFO - Waiting for application shutdown.
2025-05-31 17:45:17,295 - INFO - Shutting down server and ngrok tunnel...
2025-05-31 17:45:17,341 - INFO - Lifespan shutdown: Backed up unique users.
2025-05-31 17:45:17,342 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-31 17:45:17,343 - INFO - Application shutdown complete.
2025-05-31 17:45:17,343 - INFO - Finished server process [30632]
2025-05-31 17:48:35,023 - INFO - Starting WhatsApp FastAPI app
2025-05-31 17:48:35,124 - INFO - Started server process [33632]
2025-05-31 17:48:35,126 - INFO - Waiting for application startup.
2025-05-31 17:48:35,946 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-31 17:48:35,959 - INFO - Starting the FastAPI app with lifespan.
2025-05-31 17:48:35,959 - INFO - Application startup complete.
2025-05-31 17:48:35,960 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-31 17:48:49,832 - INFO - Shutting down
2025-05-31 17:48:49,939 - INFO - Waiting for application shutdown.
2025-05-31 17:48:49,940 - INFO - Shutting down server and ngrok tunnel...
2025-05-31 17:48:49,987 - INFO - Lifespan shutdown: Backed up unique users.
2025-05-31 17:48:49,988 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-31 17:48:49,988 - INFO - Application shutdown complete.
2025-05-31 17:48:49,989 - INFO - Finished server process [33632]
2025-05-31 17:49:30,431 - INFO - Starting WhatsApp FastAPI app
2025-05-31 17:49:30,532 - INFO - Started server process [18240]
2025-05-31 17:49:30,533 - INFO - Waiting for application startup.
2025-05-31 17:49:30,881 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-05-31 17:49:30,890 - INFO - Starting the FastAPI app with lifespan.
2025-05-31 17:49:30,890 - INFO - Application startup complete.
2025-05-31 17:49:30,891 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-05-31 17:49:52,945 - INFO - Inserted new user in DB: 919530251797
2025-05-31 17:49:52,947 - INFO - Received message from 919530251797: Hello
2025-05-31 17:49:52,947 - INFO - 2a03:2880:21ff:56:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:49:52,949 - INFO - Started message processing for user 919530251797
2025-05-31 17:49:55,955 - INFO - Processing batched messages for 919530251797: Hello
2025-05-31 17:49:59,578 - INFO - Sent response to user 919530251797, seq 1.
2025-05-31 17:50:00,540 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:50:00,541 - INFO - 2a03:2880:10ff:50:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:50:00,721 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:50:00,722 - INFO - 2a03:2880:21ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:50:32,824 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:50:32,824 - INFO - Received message from 919530251797: 6monthsmodw
2025-05-31 17:50:32,825 - INFO - 2a03:2880:22ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:50:32,826 - INFO - Message queued for user 919530251797 - processing already active
2025-05-31 17:50:35,828 - INFO - Processing batched messages for 919530251797: 6monthsmodw
2025-05-31 17:50:38,346 - INFO - Sent response to user 919530251797, seq 2.
2025-05-31 17:50:39,557 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:50:39,558 - INFO - 2a03:2880:10ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:50:39,649 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:50:39,649 - INFO - 2a03:2880:12ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:50:39,685 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:50:39,686 - INFO - 2a03:2880:22ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:51:36,154 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:51:36,154 - INFO - Received message from 919530251797: No use rahul.filtero@gmail.com
2025-05-31 17:51:36,155 - INFO - 2a03:2880:12ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:51:36,155 - INFO - Message queued for user 919530251797 - processing already active
2025-05-31 17:51:39,172 - INFO - Processing batched messages for 919530251797: No use rahul.filtero@gmail.com
2025-05-31 17:51:41,690 - INFO - Sent response to user 919530251797, seq 3.
2025-05-31 17:51:42,711 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:51:42,711 - INFO - 2a03:2880:21ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:51:42,910 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:51:42,911 - INFO - 2a03:2880:10ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:51:43,060 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:51:43,061 - INFO - 2a03:2880:10ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:52:24,007 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:52:24,007 - INFO - Received image from 919530251797
2025-05-31 17:52:27,224 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/ae81248a19304854874a3c61c2377b5e.jpg
2025-05-31 17:52:27,224 - INFO - 2a03:2880:10ff:54:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:52:27,225 - INFO - Message queued for user 919530251797 - processing already active
2025-05-31 17:52:30,229 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/ae81248a19304854874a3c61c2377b5e.jpg
2025-05-31 17:52:37,846 - INFO - Sent response to user 919530251797, seq 4.
2025-05-31 17:52:38,962 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:52:38,962 - INFO - 2a03:2880:10ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:52:39,030 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:52:39,031 - INFO - 2a03:2880:12ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:52:39,074 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:52:39,074 - INFO - 2a03:2880:22ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:52:53,739 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:52:53,739 - INFO - Received message from 919530251797: Which email id are u using
2025-05-31 17:52:53,740 - INFO - 2a03:2880:22ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:52:53,740 - INFO - Message queued for user 919530251797 - processing already active
2025-05-31 17:52:56,743 - INFO - Processing batched messages for 919530251797: Which email id are u using
2025-05-31 17:52:59,240 - INFO - Sent response to user 919530251797, seq 5.
2025-05-31 17:53:00,210 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:53:00,211 - INFO - 2a03:2880:22ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:53:00,557 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:53:00,558 - INFO - 2a03:2880:12ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:53:00,629 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:53:00,629 - INFO - 2a03:2880:10ff:d:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:54:49,841 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:54:49,841 - INFO - Received image from 919530251797
2025-05-31 17:54:53,270 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/4d662db0344d456e9fd18719840c5faf.jpg
2025-05-31 17:54:53,271 - INFO - 2a03:2880:10ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:54:53,272 - INFO - Message queued for user 919530251797 - processing already active
2025-05-31 17:54:56,275 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/4d662db0344d456e9fd18719840c5faf.jpg
2025-05-31 17:55:05,460 - INFO - Sent response to user 919530251797, seq 6.
2025-05-31 17:55:06,528 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:55:06,528 - INFO - 2a03:2880:10ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:55:06,710 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:55:06,710 - INFO - 2a03:2880:21ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:55:06,789 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:55:06,789 - INFO - 2a03:2880:10ff:a:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:55:39,617 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:55:39,617 - INFO - Received message from 919530251797: Where is my order
2025-05-31 17:55:39,618 - INFO - 2a03:2880:22ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:55:39,618 - INFO - Message queued for user 919530251797 - processing already active
2025-05-31 17:55:42,624 - INFO - Processing batched messages for 919530251797: Where is my order
2025-05-31 17:55:46,934 - INFO - Sent response to user 919530251797, seq 7.
2025-05-31 17:55:48,079 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:55:48,080 - INFO - 2a03:2880:12ff:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:55:48,187 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:55:48,187 - INFO - 2a03:2880:21ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:55:48,281 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:55:48,281 - INFO - 2a03:2880:12ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:56:17,590 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:56:17,590 - INFO - Received message from 919530251797: I need student discount code
2025-05-31 17:56:17,591 - INFO - 2a03:2880:12ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:56:17,591 - INFO - Message queued for user 919530251797 - processing already active
2025-05-31 17:56:20,603 - INFO - Processing batched messages for 919530251797: I need student discount code
2025-05-31 17:56:22,973 - INFO - Sent response to user 919530251797, seq 8.
2025-05-31 17:56:23,950 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:56:23,950 - INFO - 2a03:2880:10ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:56:24,373 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:56:24,373 - INFO - 2a03:2880:22ff:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:56:24,407 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:56:24,408 - INFO - 2a03:2880:12ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:56:32,431 - INFO - User 919530251797 found in Redis cache.
2025-05-31 17:56:32,432 - INFO - Received message from 919530251797: No
2025-05-31 17:56:32,432 - INFO - 2a03:2880:12ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:56:32,433 - INFO - Message queued for user 919530251797 - processing already active
2025-05-31 17:56:35,437 - INFO - Processing batched messages for 919530251797: No
2025-05-31 17:56:37,736 - INFO - Sent response to user 919530251797, seq 9.
2025-05-31 17:56:38,751 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:56:38,752 - INFO - 2a03:2880:22ff:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:56:39,091 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:56:39,092 - INFO - 2a03:2880:12ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:56:39,162 - WARNING - Webhook payload does not include a phone number.
2025-05-31 17:56:39,163 - INFO - 2a03:2880:10ff:48:::0 - "POST /webhook HTTP/1.1" 200
2025-05-31 17:59:05,440 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-05-31 17:59:05,442 - INFO - Cleaned up processing task for user 919530251797.
2025-05-31 20:52:04,826 - ERROR - t=2025-05-31T20:52:03+0530 lvl=eror msg="heartbeat timeout, terminating session" obj=tunnels.session obj=csess id=57f6acba860b clientid=7773334152e1a155c59c191333aeeb8d
2025-05-31 20:52:04,991 - ERROR - t=2025-05-31T20:52:04+0530 lvl=eror msg="session closed, starting reconnect loop" obj=tunnels.session obj=csess id=18020ee0afbe err="read tcp 192.168.1.15:58061->3.6.96.240:443: wsarecv: An existing connection was forcibly closed by the remote host."
2025-05-31 20:52:17,683 - INFO - Shutting down
2025-05-31 20:52:17,803 - INFO - Waiting for application shutdown.
2025-05-31 20:52:17,804 - INFO - Shutting down server and ngrok tunnel...
2025-05-31 20:52:18,103 - INFO - Lifespan shutdown: Backed up unique users.
2025-05-31 20:52:18,106 - INFO - Lifespan shutdown: Cleaned up resources.
2025-05-31 20:52:18,109 - INFO - Application shutdown complete.
2025-05-31 20:52:18,110 - INFO - Finished server process [18240]
2025-06-04 13:41:38,945 - INFO - Starting WhatsApp FastAPI app
2025-06-04 13:41:39,121 - INFO - Started server process [18164]
2025-06-04 13:41:39,122 - INFO - Waiting for application startup.
2025-06-04 13:41:40,663 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 13:41:44,790 - ERROR - Traceback (most recent call last):
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\asyncio\connection.py", line 281, in connect
    await self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect()
    )
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\asyncio\retry.py", line 59, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\asyncio\connection.py", line 697, in _connect
    reader, writer = await asyncio.open_connection(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **self._connection_arguments()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\asyncio\streams.py", line 48, in open_connection
    transport, _ = await loop.create_connection(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        lambda: protocol, host, port, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1160, in create_connection
    raise exceptions[0]
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1137, in create_connection
    sock = await self._connect_sock(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
        exceptions, addrinfo, laddr_infos)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1040, in _connect_sock
    await self.sock_connect(sock, address)
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 726, in sock_connect
    return await self._proactor.connect(sock, address)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\asyncio\windows_events.py", line 804, in _poll
    value = callback(transferred, key, ov)
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\asyncio\windows_events.py", line 600, in finish_connect
    ov.getresult()
    ~~~~~~~~~~~~^^
ConnectionRefusedError: [WinError 1225] The remote computer refused the network connection

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 72, in lifespan
    response = await redis.ping()
               ^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\asyncio\client.py", line 611, in execute_command
    conn = self.connection or await pool.get_connection(command_name, **options)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\asyncio\connection.py", line 1064, in get_connection
    await self.ensure_connection(connection)
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\asyncio\connection.py", line 1097, in ensure_connection
    await connection.connect()
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\asyncio\connection.py", line 289, in connect
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 22 connecting to localhost:6379. The remote computer refused the network connection.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py", line 693, in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Jhajharia\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jhajharia\Desktop\NasherMiles AI\whatsapp_app.py", line 79, in lifespan
    sys.exit(1)
    ~~~~~~~~^^^
SystemExit: 1

2025-06-04 13:41:44,801 - ERROR - Application startup failed. Exiting.
2025-06-04 13:42:30,514 - INFO - Starting WhatsApp FastAPI app
2025-06-04 13:42:30,614 - INFO - Started server process [23076]
2025-06-04 13:42:30,614 - INFO - Waiting for application startup.
2025-06-04 13:42:31,052 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 13:42:31,058 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 13:42:31,058 - INFO - Application startup complete.
2025-06-04 13:42:31,059 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 13:42:54,521 - INFO - User 919530251797 found in MongoDB and cached in Redis.
2025-06-04 13:42:54,521 - INFO - Received message from 919530251797: Hi
2025-06-04 13:42:54,522 - INFO - 2a03:2880:10ff:e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:42:54,522 - INFO - Started message processing for user 919530251797
2025-06-04 13:42:57,532 - INFO - Processing batched messages for 919530251797: Hi
2025-06-04 13:43:02,989 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 13:43:03,910 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:43:03,910 - INFO - 2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:43:04,284 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:43:04,285 - INFO - 2a03:2880:10ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:43:04,369 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:43:04,369 - INFO - 2a03:2880:10ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:43:29,683 - INFO - Inserted new user in DB: 919530251797
2025-06-04 13:43:29,684 - INFO - Received message from 919530251797: Hi
2025-06-04 13:43:29,685 - INFO - 2a03:2880:21ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:43:29,686 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 13:43:32,693 - INFO - Processing batched messages for 919530251797: Hi
2025-06-04 13:43:35,276 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 13:43:36,312 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:43:36,313 - INFO - 2a03:2880:10ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:43:36,525 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:43:36,526 - INFO - 2a03:2880:10ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:43:37,367 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:43:37,368 - INFO - 2a03:2880:12ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:43:51,802 - INFO - User 919530251797 found in Redis cache.
2025-06-04 13:43:51,802 - INFO - Received message from 919530251797: Any discount available?
2025-06-04 13:43:51,803 - INFO - 2a03:2880:10ff:f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:43:51,804 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 13:43:54,806 - INFO - Processing batched messages for 919530251797: Any discount available?
2025-06-04 13:43:58,717 - INFO - Sent response to user 919530251797, seq 3.
2025-06-04 13:43:59,745 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:43:59,746 - INFO - 2a03:2880:10ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:43:59,925 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:43:59,926 - INFO - 2a03:2880:21ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:44:07,119 - INFO - User 919530251797 found in Redis cache.
2025-06-04 13:44:08,519 - INFO - 2a03:2880:22ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:44:10,583 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:44:10,584 - INFO - 2a03:2880:21ff:4c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:44:11,070 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:44:11,071 - INFO - 2a03:2880:21ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:44:11,174 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:44:11,175 - INFO - 2a03:2880:12ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:44:18,981 - INFO - Shutting down
2025-06-04 13:44:19,094 - INFO - Waiting for application shutdown.
2025-06-04 13:44:19,095 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 13:44:19,143 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 13:44:19,143 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 13:44:19,144 - INFO - Application shutdown complete.
2025-06-04 13:44:19,145 - INFO - Finished server process [23076]
2025-06-04 13:44:19,146 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 13:44:19,146 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 13:47:01,211 - INFO - Starting WhatsApp FastAPI app
2025-06-04 13:47:01,344 - INFO - Started server process [26984]
2025-06-04 13:47:01,345 - INFO - Waiting for application startup.
2025-06-04 13:47:01,821 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 13:47:01,827 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 13:47:01,828 - INFO - Application startup complete.
2025-06-04 13:47:01,828 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 13:47:10,330 - INFO - User 919530251797 found in Redis cache.
2025-06-04 13:47:11,448 - INFO - 2a03:2880:12ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:47:12,744 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:47:12,745 - INFO - 2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:47:13,113 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:47:13,113 - INFO - 2a03:2880:22ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:47:13,229 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:47:13,230 - INFO - 2a03:2880:22ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:47:26,366 - INFO - User 919530251797 found in Redis cache.
2025-06-04 13:47:27,152 - INFO - 2a03:2880:10ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:47:28,163 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:47:28,163 - INFO - 2a03:2880:10ff:a:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:47:28,573 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:47:28,574 - INFO - 2a03:2880:21ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:47:28,585 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:47:28,586 - INFO - 2a03:2880:21ff:45:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:47:49,854 - INFO - User 919530251797 found in Redis cache.
2025-06-04 13:47:49,854 - INFO - Received message from 919530251797: Alexendria bag price
2025-06-04 13:47:49,855 - INFO - 2a03:2880:21ff:42:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:47:49,855 - INFO - Started message processing for user 919530251797
2025-06-04 13:47:52,870 - INFO - Processing batched messages for 919530251797: Alexendria bag price
2025-06-04 13:48:11,610 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 13:48:12,509 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:48:12,509 - INFO - 2a03:2880:21ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:48:12,793 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:48:12,793 - INFO - 2a03:2880:21ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:48:12,856 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:48:12,856 - INFO - 2a03:2880:21ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:48:33,293 - INFO - User 919530251797 found in Redis cache.
2025-06-04 13:48:33,293 - INFO - Received message from 919530251797: I want to know the price
2025-06-04 13:48:33,294 - INFO - 2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:48:33,295 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 13:48:36,303 - INFO - Processing batched messages for 919530251797: I want to know the price
2025-06-04 13:48:50,082 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 13:48:51,113 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:48:51,113 - INFO - 2a03:2880:22ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:48:51,362 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:48:51,363 - INFO - 2a03:2880:10ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:48:51,430 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:48:51,430 - INFO - 2a03:2880:10ff:e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:51:06,306 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-06-04 13:51:06,307 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 13:54:34,794 - INFO - Shutting down
2025-06-04 13:54:34,902 - INFO - Waiting for application shutdown.
2025-06-04 13:54:34,903 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 13:54:34,948 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 13:54:34,948 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 13:54:34,949 - INFO - Application shutdown complete.
2025-06-04 13:54:34,949 - INFO - Finished server process [26984]
2025-06-04 13:54:53,995 - INFO - Starting WhatsApp FastAPI app
2025-06-04 13:54:54,104 - INFO - Started server process [25556]
2025-06-04 13:54:54,105 - INFO - Waiting for application startup.
2025-06-04 13:54:54,602 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 13:54:54,607 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 13:54:54,607 - INFO - Application startup complete.
2025-06-04 13:54:54,608 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 13:55:23,396 - INFO - User 919530251797 found in Redis cache.
2025-06-04 13:55:23,396 - INFO - Received message from 919530251797: Antwerp bag price
2025-06-04 13:55:23,397 - INFO - 2a03:2880:10ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:55:23,398 - INFO - Started message processing for user 919530251797
2025-06-04 13:55:26,412 - INFO - Processing batched messages for 919530251797: Antwerp bag price
2025-06-04 13:55:51,400 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 13:55:52,684 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:55:52,685 - INFO - 2a03:2880:12ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:55:52,853 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:55:52,853 - INFO - 2a03:2880:12ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:55:53,103 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:55:53,103 - INFO - 2a03:2880:12ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:57:56,425 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-06-04 13:57:56,426 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 13:58:07,441 - INFO - Shutting down
2025-06-04 13:58:07,549 - INFO - Waiting for application shutdown.
2025-06-04 13:58:07,549 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 13:58:07,595 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 13:58:07,595 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 13:58:07,595 - INFO - Application shutdown complete.
2025-06-04 13:58:07,595 - INFO - Finished server process [25556]
2025-06-04 13:58:24,752 - INFO - Starting WhatsApp FastAPI app
2025-06-04 13:58:24,856 - INFO - Started server process [24244]
2025-06-04 13:58:24,857 - INFO - Waiting for application startup.
2025-06-04 13:58:25,459 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 13:58:25,465 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 13:58:25,465 - INFO - Application startup complete.
2025-06-04 13:58:25,466 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 13:58:55,164 - INFO - User 919530251797 found in Redis cache.
2025-06-04 13:58:55,164 - INFO - Received message from 919530251797: Dubai large bag size price
2025-06-04 13:58:55,164 - INFO - 2a03:2880:10ff:f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:58:55,165 - INFO - Started message processing for user 919530251797
2025-06-04 13:58:58,170 - INFO - Processing batched messages for 919530251797: Dubai large bag size price
2025-06-04 13:59:10,061 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 13:59:11,170 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:59:11,170 - INFO - 2a03:2880:21ff:5f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:59:11,438 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:59:11,439 - INFO - 2a03:2880:10ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:59:11,441 - WARNING - Webhook payload does not include a phone number.
2025-06-04 13:59:11,442 - INFO - 2a03:2880:10ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:59:54,539 - INFO - User 919530251797 found in Redis cache.
2025-06-04 13:59:54,539 - INFO - Received message from 919530251797: What is the price of this lavender color
2025-06-04 13:59:54,540 - INFO - 2a03:2880:12ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 13:59:54,541 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 13:59:57,553 - INFO - Processing batched messages for 919530251797: What is the price of this lavender color
2025-06-04 14:00:00,223 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 14:00:01,298 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:00:01,298 - INFO - 2a03:2880:21ff:b:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:00:01,413 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:00:01,414 - INFO - 2a03:2880:10ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:00:01,784 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:00:01,785 - INFO - 2a03:2880:12ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:01:20,055 - INFO - User 919530251797 found in Redis cache.
2025-06-04 14:01:20,055 - INFO - Received message from 919530251797: Any sale going on?
2025-06-04 14:01:20,055 - INFO - 2a03:2880:22ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:01:20,056 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 14:01:23,064 - INFO - Processing batched messages for 919530251797: Any sale going on?
2025-06-04 14:01:27,301 - INFO - Sent response to user 919530251797, seq 3.
2025-06-04 14:01:28,282 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:01:28,283 - INFO - 2a03:2880:21ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:01:28,586 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:01:28,586 - INFO - 2a03:2880:10ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:01:28,707 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:01:28,707 - INFO - 2a03:2880:10ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:03:05,834 - INFO - Shutting down
2025-06-04 14:03:05,943 - INFO - Waiting for application shutdown.
2025-06-04 14:03:05,944 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 14:03:05,984 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 14:03:05,985 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 14:03:05,985 - INFO - Application shutdown complete.
2025-06-04 14:03:05,987 - INFO - Finished server process [24244]
2025-06-04 14:03:05,988 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 14:03:05,988 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 14:03:24,891 - INFO - Starting WhatsApp FastAPI app
2025-06-04 14:03:24,991 - INFO - Started server process [26220]
2025-06-04 14:03:24,992 - INFO - Waiting for application startup.
2025-06-04 14:03:25,442 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 14:03:25,447 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 14:03:25,447 - INFO - Application startup complete.
2025-06-04 14:03:25,448 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 14:03:35,733 - INFO - User 919530251797 found in Redis cache.
2025-06-04 14:03:35,733 - INFO - Received message from 919530251797: Any sale going on?
2025-06-04 14:03:35,734 - INFO - 2a03:2880:21ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:03:35,734 - INFO - Started message processing for user 919530251797
2025-06-04 14:03:38,743 - INFO - Processing batched messages for 919530251797: Any sale going on?
2025-06-04 14:03:46,469 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 14:03:47,558 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:03:47,559 - INFO - 2a03:2880:21ff:4c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:03:47,653 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:03:47,653 - INFO - 2a03:2880:21ff:a:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:03:56,768 - INFO - User 919530251797 found in Redis cache.
2025-06-04 14:03:56,769 - INFO - Received message from 919530251797: Nice
2025-06-04 14:03:56,769 - INFO - 2a03:2880:22ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:03:56,770 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 14:03:59,773 - INFO - Processing batched messages for 919530251797: Nice
2025-06-04 14:04:02,175 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 14:04:03,221 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:04:03,221 - INFO - 2a03:2880:10ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:04:03,468 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:04:03,469 - INFO - 2a03:2880:21ff:46:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:04:03,530 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:04:03,530 - INFO - 2a03:2880:22ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:04:09,585 - INFO - User 919530251797 found in Redis cache.
2025-06-04 14:04:09,586 - INFO - Received message from 919530251797: I want student discount
2025-06-04 14:04:09,586 - INFO - 2a03:2880:12ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:04:09,587 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 14:04:12,592 - INFO - Processing batched messages for 919530251797: I want student discount
2025-06-04 14:04:14,962 - INFO - Sent response to user 919530251797, seq 3.
2025-06-04 14:04:15,972 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:04:15,973 - INFO - 2a03:2880:21ff:b:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:04:16,261 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:04:16,262 - INFO - 2a03:2880:21ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:04:16,329 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:04:16,329 - INFO - 2a03:2880:22ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:04:30,713 - INFO - User 919530251797 found in Redis cache.
2025-06-04 14:04:30,713 - INFO - Received message from 919530251797: Rahul@gmail.com
2025-06-04 14:04:30,714 - INFO - 2a03:2880:21ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:04:30,714 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 14:04:33,724 - INFO - Processing batched messages for 919530251797: Rahul@gmail.com
2025-06-04 14:04:36,495 - INFO - Sent response to user 919530251797, seq 4.
2025-06-04 14:04:37,531 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:04:37,531 - INFO - 2a03:2880:21ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:04:37,760 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:04:37,760 - INFO - 2a03:2880:10ff:b:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:04:37,810 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:04:37,811 - INFO - 2a03:2880:21ff:45:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:07:03,734 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-06-04 14:07:03,735 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 14:07:47,578 - INFO - User 919530251797 found in Redis cache.
2025-06-04 14:07:47,578 - INFO - Received message from 919530251797: Fuck u guve me discount code motherfucker i will turn you off i know where u live
2025-06-04 14:07:47,578 - INFO - 2a03:2880:10ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:07:47,579 - INFO - Started message processing for user 919530251797
2025-06-04 14:07:50,588 - INFO - Processing batched messages for 919530251797: Fuck u guve me discount code motherfucker i will turn you off i know where u live
2025-06-04 14:07:58,173 - INFO - Sent response to user 919530251797, seq 5.
2025-06-04 14:07:59,150 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:07:59,150 - INFO - 2a03:2880:22ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:07:59,373 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:07:59,374 - INFO - 2a03:2880:21ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:07:59,547 - WARNING - Webhook payload does not include a phone number.
2025-06-04 14:07:59,547 - INFO - 2a03:2880:22ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 14:10:20,598 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-06-04 14:10:20,598 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 15:31:34,515 - ERROR - t=2025-06-04T15:31:34+0530 lvl=eror msg="heartbeat timeout, terminating session" obj=tunnels.session obj=csess id=bc56d66e0c40 clientid=ec25f590319fc186fc17650614dc1dca
2025-06-04 15:31:34,516 - ERROR - t=2025-06-04T15:31:34+0530 lvl=eror msg="session closed, starting reconnect loop" obj=tunnels.session obj=csess id=f01f4f95c3fb err="session closed"
2025-06-04 16:18:58,884 - INFO - Shutting down
2025-06-04 16:18:58,993 - INFO - Waiting for application shutdown.
2025-06-04 16:18:58,994 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 16:18:59,345 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 16:18:59,346 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 16:18:59,347 - INFO - Application shutdown complete.
2025-06-04 16:18:59,348 - INFO - Finished server process [26220]
2025-06-04 16:22:16,860 - INFO - Starting WhatsApp FastAPI app
2025-06-04 16:22:17,029 - INFO - Started server process [27260]
2025-06-04 16:22:17,030 - INFO - Waiting for application startup.
2025-06-04 16:22:17,762 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 16:22:17,798 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 16:22:17,799 - INFO - Application startup complete.
2025-06-04 16:22:17,799 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 16:22:43,011 - INFO - Shutting down
2025-06-04 16:22:43,121 - INFO - Waiting for application shutdown.
2025-06-04 16:22:43,122 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 16:22:43,166 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 16:22:43,166 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 16:22:43,167 - INFO - Application shutdown complete.
2025-06-04 16:22:43,167 - INFO - Finished server process [27260]
2025-06-04 16:41:53,956 - INFO - Starting WhatsApp FastAPI app
2025-06-04 16:41:54,085 - INFO - Started server process [15712]
2025-06-04 16:41:54,086 - INFO - Waiting for application startup.
2025-06-04 16:41:54,822 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 16:41:54,834 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 16:41:54,834 - INFO - Application startup complete.
2025-06-04 16:41:54,835 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 16:43:10,457 - INFO - Shutting down
2025-06-04 16:43:10,566 - INFO - Waiting for application shutdown.
2025-06-04 16:43:10,566 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 16:43:10,609 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 16:43:10,610 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 16:43:10,610 - INFO - Application shutdown complete.
2025-06-04 16:43:10,611 - INFO - Finished server process [15712]
2025-06-04 16:43:47,828 - INFO - Starting WhatsApp FastAPI app
2025-06-04 16:43:47,952 - INFO - Started server process [508]
2025-06-04 16:43:47,953 - INFO - Waiting for application startup.
2025-06-04 16:43:48,328 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 16:43:48,337 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 16:43:48,338 - INFO - Application startup complete.
2025-06-04 16:43:48,339 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 16:44:02,745 - INFO - Shutting down
2025-06-04 16:44:02,855 - INFO - Waiting for application shutdown.
2025-06-04 16:44:02,855 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 16:44:02,894 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 16:44:02,895 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 16:44:02,895 - INFO - Application shutdown complete.
2025-06-04 16:44:02,895 - INFO - Finished server process [508]
2025-06-04 16:44:30,945 - INFO - Starting WhatsApp FastAPI app
2025-06-04 16:44:31,057 - INFO - Started server process [27316]
2025-06-04 16:44:31,058 - INFO - Waiting for application startup.
2025-06-04 16:44:31,562 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 16:44:31,569 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 16:44:31,570 - INFO - Application startup complete.
2025-06-04 16:44:31,570 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 16:44:44,872 - INFO - Inserted new user in DB: 919530251797
2025-06-04 16:44:44,882 - INFO - Received message from 919530251797: Hi
2025-06-04 16:44:44,882 - INFO - 2a03:2880:21ff:c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:44:44,883 - INFO - Started message processing for user 919530251797
2025-06-04 16:44:47,892 - INFO - Processing batched messages for 919530251797: Hi
2025-06-04 16:44:51,805 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 16:44:52,842 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:44:52,842 - INFO - 2a03:2880:21ff:47:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:44:53,277 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:44:53,278 - INFO - 2a03:2880:10ff:40:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:44:53,564 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:44:53,565 - INFO - 2a03:2880:12ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:45:07,905 - INFO - User 919530251797 found in Redis cache.
2025-06-04 16:45:07,905 - INFO - Received message from 919530251797: Current discounts
2025-06-04 16:45:07,906 - INFO - 2a03:2880:10ff:a:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:45:07,906 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 16:45:10,910 - INFO - Processing batched messages for 919530251797: Current discounts
2025-06-04 16:45:14,374 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 16:45:15,571 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:45:15,572 - INFO - 2a03:2880:22ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:45:15,724 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:45:15,725 - INFO - 2a03:2880:22ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:45:15,833 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:45:15,833 - INFO - 2a03:2880:12ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:45:25,463 - INFO - User 919530251797 found in Redis cache.
2025-06-04 16:45:26,464 - INFO - 2a03:2880:22ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:45:28,115 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:45:28,116 - INFO - 2a03:2880:10ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:45:28,475 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:45:28,475 - INFO - 2a03:2880:12ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:45:28,534 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:45:28,535 - INFO - 2a03:2880:21ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:45:46,814 - INFO - User 919530251797 found in Redis cache.
2025-06-04 16:45:46,815 - INFO - Received message from 919530251797: How much will i get in student discount
2025-06-04 16:45:46,815 - INFO - 2a03:2880:10ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:45:46,816 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 16:45:49,832 - INFO - Processing batched messages for 919530251797: How much will i get in student discount
2025-06-04 16:45:54,956 - INFO - Sent response to user 919530251797, seq 3.
2025-06-04 16:45:56,239 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:45:56,239 - INFO - 2a03:2880:10ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:45:56,270 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:45:56,270 - INFO - 2a03:2880:12ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:45:56,405 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:45:56,406 - INFO - 2a03:2880:12ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:46:02,282 - INFO - User 919530251797 found in Redis cache.
2025-06-04 16:46:02,283 - INFO - Received message from 919530251797: Ok
2025-06-04 16:46:02,283 - INFO - 2a03:2880:21ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:46:02,284 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 16:46:05,286 - INFO - Processing batched messages for 919530251797: Ok
2025-06-04 16:46:07,930 - INFO - Sent response to user 919530251797, seq 4.
2025-06-04 16:46:08,851 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:46:08,852 - INFO - 2a03:2880:10ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:46:09,073 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:46:09,073 - INFO - 2a03:2880:22ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:46:09,227 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:46:09,227 - INFO - 2a03:2880:10ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:46:32,540 - INFO - User 919530251797 found in Redis cache.
2025-06-04 16:46:32,541 - INFO - Received message from 919530251797: Rahul20110@iiitd.ac.in
2025-06-04 16:46:32,541 - INFO - 2a03:2880:21ff:c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:46:32,542 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 16:46:35,544 - INFO - Processing batched messages for 919530251797: Rahul20110@iiitd.ac.in
2025-06-04 16:46:37,830 - INFO - Sent response to user 919530251797, seq 5.
2025-06-04 16:46:38,824 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:46:38,824 - INFO - 2a03:2880:21ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:46:39,183 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:46:39,184 - INFO - 2a03:2880:12ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:46:39,406 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:46:39,406 - INFO - 2a03:2880:12ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:47:06,343 - INFO - User 919530251797 found in Redis cache.
2025-06-04 16:47:06,344 - INFO - Received image from 919530251797
2025-06-04 16:47:10,172 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/405cd8e2851e4b529c9eb6ca472e434f.jpg
2025-06-04 16:47:10,172 - INFO - 2a03:2880:12ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:47:10,173 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 16:47:13,186 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/405cd8e2851e4b529c9eb6ca472e434f.jpg
2025-06-04 16:47:22,061 - INFO - Sent response to user 919530251797, seq 6.
2025-06-04 16:47:23,378 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:47:23,378 - INFO - 2a03:2880:21ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:47:23,409 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:47:23,410 - INFO - 2a03:2880:12ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:47:23,534 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:47:23,534 - INFO - 2a03:2880:10ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:47:40,700 - INFO - User 919530251797 found in Redis cache.
2025-06-04 16:47:40,700 - INFO - Received image from 919530251797
2025-06-04 16:47:44,008 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/818738ac74c0409b88f2dbcf853ea98c.jpg
2025-06-04 16:47:44,008 - INFO - 2a03:2880:22ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:47:44,008 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 16:47:47,016 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/818738ac74c0409b88f2dbcf853ea98c.jpg
2025-06-04 16:47:53,690 - INFO - Sent response to user 919530251797, seq 7.
2025-06-04 16:47:54,730 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:47:54,730 - INFO - 2a03:2880:22ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:47:55,043 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:47:55,043 - INFO - 2a03:2880:10ff:40:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:47:55,084 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:47:55,084 - INFO - 2a03:2880:21ff:4a:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:48:34,831 - INFO - User 919530251797 found in Redis cache.
2025-06-04 16:48:34,831 - INFO - Received message from 919530251797: I want to track my order
2025-06-04 16:48:34,832 - INFO - 2a03:2880:10ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:48:34,832 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 16:48:37,843 - INFO - Processing batched messages for 919530251797: I want to track my order
2025-06-04 16:48:40,161 - INFO - Sent response to user 919530251797, seq 8.
2025-06-04 16:48:41,347 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:48:41,348 - INFO - 2a03:2880:10ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:48:41,538 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:48:41,539 - INFO - 2a03:2880:21ff:56:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:48:41,700 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:48:41,700 - INFO - 2a03:2880:12ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:51:07,859 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-06-04 16:51:07,859 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 16:51:31,646 - INFO - Shutting down
2025-06-04 16:51:31,756 - INFO - Waiting for application shutdown.
2025-06-04 16:51:31,757 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 16:51:31,800 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 16:51:31,801 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 16:51:31,801 - INFO - Application shutdown complete.
2025-06-04 16:51:31,802 - INFO - Finished server process [27316]
2025-06-04 16:51:47,289 - INFO - Starting WhatsApp FastAPI app
2025-06-04 16:51:47,386 - INFO - Started server process [17292]
2025-06-04 16:51:47,387 - INFO - Waiting for application startup.
2025-06-04 16:51:47,913 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 16:51:47,920 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 16:51:47,921 - INFO - Application startup complete.
2025-06-04 16:51:47,921 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 16:52:15,611 - INFO - User 919530251797 found in Redis cache.
2025-06-04 16:52:15,611 - INFO - Received message from 919530251797: I want to track my order
2025-06-04 16:52:15,612 - INFO - 2a03:2880:21ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:52:15,613 - INFO - Started message processing for user 919530251797
2025-06-04 16:52:18,627 - INFO - Processing batched messages for 919530251797: I want to track my order
2025-06-04 16:52:25,453 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 16:52:26,570 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:52:26,571 - INFO - 2a03:2880:10ff:e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:52:26,755 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:52:26,756 - INFO - 2a03:2880:21ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:52:26,901 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:52:26,901 - INFO - 2a03:2880:10ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:53:30,552 - INFO - User 919530251797 found in Redis cache.
2025-06-04 16:53:30,553 - INFO - Received message from 919530251797: NM56458
2025-06-04 16:53:30,553 - INFO - 2a03:2880:21ff:c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:53:30,554 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 16:53:33,569 - INFO - Processing batched messages for 919530251797: NM56458
2025-06-04 16:53:38,703 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 16:53:39,754 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:53:39,754 - INFO - 2a03:2880:22ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:53:40,064 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:53:40,064 - INFO - 2a03:2880:10ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:53:40,119 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:53:40,119 - INFO - 2a03:2880:22ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:53:46,906 - INFO - User 919530251797 found in Redis cache.
2025-06-04 16:53:46,907 - INFO - Received message from 919530251797: Thanx
2025-06-04 16:53:46,907 - INFO - 2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:53:46,908 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 16:53:49,914 - INFO - Processing batched messages for 919530251797: Thanx
2025-06-04 16:53:52,111 - INFO - Sent response to user 919530251797, seq 3.
2025-06-04 16:53:53,334 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:53:53,334 - INFO - 2a03:2880:12ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:53:53,371 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:53:53,371 - INFO - 2a03:2880:10ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:53:53,444 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:53:53,444 - INFO - 2a03:2880:22ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:54:35,017 - INFO - User 919530251797 found in Redis cache.
2025-06-04 16:54:35,017 - INFO - Received message from 919530251797: NM56234
2025-06-04 16:54:35,018 - INFO - 2a03:2880:10ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:54:35,019 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 16:54:38,026 - INFO - Processing batched messages for 919530251797: NM56234
2025-06-04 16:54:40,761 - INFO - Extracted cp_id=4 from URL.
2025-06-04 16:54:44,282 - INFO - Sent response to user 919530251797, seq 4.
2025-06-04 16:54:45,519 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:54:45,519 - INFO - 2a03:2880:12ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:54:45,602 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:54:45,602 - INFO - 2a03:2880:10ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:54:45,727 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:54:45,728 - INFO - 2a03:2880:12ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:55:49,713 - INFO - User 919530251797 found in Redis cache.
2025-06-04 16:55:49,714 - INFO - Received message from 919530251797: NM56240
2025-06-04 16:55:49,714 - INFO - 2a03:2880:21ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:55:49,715 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 16:55:52,729 - INFO - Processing batched messages for 919530251797: NM56240
2025-06-04 16:55:56,826 - INFO - Extracted cp_id=4 from URL.
2025-06-04 16:56:00,047 - INFO - Sent response to user 919530251797, seq 5.
2025-06-04 16:56:01,307 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:56:01,307 - INFO - 2a03:2880:12ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:56:01,384 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:56:01,385 - INFO - 2a03:2880:21ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:56:01,538 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:56:01,538 - INFO - 2a03:2880:10ff:f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:56:37,415 - INFO - User 919530251797 found in Redis cache.
2025-06-04 16:56:37,415 - INFO - Received message from 919530251797: NM56291
2025-06-04 16:56:37,416 - INFO - 2a03:2880:22ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:56:37,416 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 16:56:40,424 - INFO - Processing batched messages for 919530251797: NM56291
2025-06-04 16:56:42,882 - INFO - Extracted cp_id=9 from URL.
2025-06-04 16:56:46,302 - INFO - Sent response to user 919530251797, seq 6.
2025-06-04 16:56:47,245 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:56:47,245 - INFO - 2a03:2880:22ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:56:47,521 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:56:47,521 - INFO - 2a03:2880:10ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:56:47,673 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:56:47,674 - INFO - 2a03:2880:22ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:58:21,729 - INFO - User 919530251797 found in Redis cache.
2025-06-04 16:58:21,729 - INFO - Received message from 919530251797: I want to cancel my order
2025-06-04 16:58:21,729 - INFO - 2a03:2880:10ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:58:21,730 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 16:58:24,745 - INFO - Processing batched messages for 919530251797: I want to cancel my order
2025-06-04 16:58:27,270 - INFO - Sent response to user 919530251797, seq 7.
2025-06-04 16:58:28,285 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:58:28,286 - INFO - 2a03:2880:21ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:58:28,488 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:58:28,488 - INFO - 2a03:2880:21ff:55:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:58:28,524 - WARNING - Webhook payload does not include a phone number.
2025-06-04 16:58:28,525 - INFO - 2a03:2880:21ff:45:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 16:58:48,691 - INFO - Shutting down
2025-06-04 16:58:48,801 - INFO - Waiting for application shutdown.
2025-06-04 16:58:48,801 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 16:58:48,839 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 16:58:48,840 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 16:58:48,840 - INFO - Application shutdown complete.
2025-06-04 16:58:48,841 - INFO - Finished server process [17292]
2025-06-04 16:58:48,842 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 16:58:48,843 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 17:00:28,754 - INFO - Starting WhatsApp FastAPI app
2025-06-04 17:00:28,854 - INFO - Started server process [12316]
2025-06-04 17:00:28,855 - INFO - Waiting for application startup.
2025-06-04 17:00:29,335 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 17:00:29,343 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 17:00:29,343 - INFO - Application startup complete.
2025-06-04 17:00:29,344 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 17:00:57,645 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:00:57,645 - INFO - Received message from 919530251797: I want to cancel my order
2025-06-04 17:00:57,646 - INFO - 2a03:2880:21ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:00:57,647 - INFO - Started message processing for user 919530251797
2025-06-04 17:01:00,652 - INFO - Processing batched messages for 919530251797: I want to cancel my order
2025-06-04 17:01:04,707 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 17:01:05,805 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:01:05,805 - INFO - 2a03:2880:10ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:01:05,975 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:01:05,975 - INFO - 2a03:2880:10ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:01:06,075 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:01:06,075 - INFO - 2a03:2880:10ff:f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:01:44,641 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:01:44,642 - INFO - Received message from 919530251797: I ordered by mistake nm56458
2025-06-04 17:01:44,642 - INFO - 2a03:2880:10ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:01:44,643 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:01:47,648 - INFO - Processing batched messages for 919530251797: I ordered by mistake nm56458
2025-06-04 17:01:55,270 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 17:01:56,230 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:01:56,231 - INFO - 2a03:2880:10ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:01:56,590 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:01:56,590 - INFO - 2a03:2880:10ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:01:56,682 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:01:56,683 - INFO - 2a03:2880:22ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:02:07,373 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:02:07,374 - INFO - Received message from 919530251797: devilisback484@gmail.com
2025-06-04 17:02:07,374 - INFO - 2a03:2880:22ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:02:07,375 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:02:10,382 - INFO - Processing batched messages for 919530251797: devilisback484@gmail.com
2025-06-04 17:02:16,316 - INFO - Sent response to user 919530251797, seq 3.
2025-06-04 17:02:17,325 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:02:17,325 - INFO - 2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:02:17,601 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:02:17,601 - INFO - 2a03:2880:10ff:b:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:02:17,676 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:02:17,677 - INFO - 2a03:2880:22ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:04:40,398 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-06-04 17:04:40,398 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 17:07:18,013 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:07:18,013 - INFO - Received message from 919530251797: 6monthsmore
2025-06-04 17:07:18,014 - INFO - 2a03:2880:22ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:07:18,014 - INFO - Started message processing for user 919530251797
2025-06-04 17:07:21,018 - INFO - Processing batched messages for 919530251797: 6monthsmore
2025-06-04 17:07:25,599 - INFO - Sent response to user 919530251797, seq 4.
2025-06-04 17:07:26,805 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:07:26,805 - INFO - 2a03:2880:21ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:07:27,013 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:07:27,014 - INFO - 2a03:2880:12ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:07:27,195 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:07:27,195 - INFO - 2a03:2880:12ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:07:50,167 - INFO - Shutting down
2025-06-04 17:07:50,277 - INFO - Waiting for application shutdown.
2025-06-04 17:07:50,277 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 17:07:50,319 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 17:07:50,319 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 17:07:50,320 - INFO - Application shutdown complete.
2025-06-04 17:07:50,320 - INFO - Finished server process [12316]
2025-06-04 17:07:50,321 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 17:07:50,321 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 17:08:20,813 - INFO - Starting WhatsApp FastAPI app
2025-06-04 17:08:20,908 - INFO - Started server process [25800]
2025-06-04 17:08:20,909 - INFO - Waiting for application startup.
2025-06-04 17:08:21,395 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 17:08:21,402 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 17:08:21,402 - INFO - Application startup complete.
2025-06-04 17:08:21,403 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 17:08:32,423 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:08:32,423 - INFO - Received message from 919530251797: Yeah
2025-06-04 17:08:32,424 - INFO - 2a03:2880:22ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:08:32,424 - INFO - Started message processing for user 919530251797
2025-06-04 17:08:35,428 - INFO - Processing batched messages for 919530251797: Yeah
2025-06-04 17:08:39,295 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 17:08:40,329 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:08:40,330 - INFO - 2a03:2880:10ff:40:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:08:40,680 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:08:40,681 - INFO - 2a03:2880:12ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:08:40,716 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:08:40,716 - INFO - 2a03:2880:10ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:08:41,669 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:08:41,669 - INFO - Received message from 919530251797: Yes
2025-06-04 17:08:41,669 - INFO - 2a03:2880:10ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:08:41,670 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:08:44,685 - INFO - Processing batched messages for 919530251797: Yes
2025-06-04 17:08:46,696 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 17:08:47,807 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:08:47,808 - INFO - 2a03:2880:22ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:08:48,093 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:08:48,093 - INFO - 2a03:2880:12ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:08:48,129 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:08:48,130 - INFO - 2a03:2880:22ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:09:08,135 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:09:08,135 - INFO - Received image from 919530251797
2025-06-04 17:09:11,169 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/a44f86ba3ff24c9fb96eeda4f2cc8493.jpg
2025-06-04 17:09:11,170 - INFO - 2a03:2880:21ff:4c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:09:11,171 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:09:14,185 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/a44f86ba3ff24c9fb96eeda4f2cc8493.jpg
2025-06-04 17:09:29,987 - INFO - Sent response to user 919530251797, seq 3.
2025-06-04 17:09:31,079 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:09:31,079 - INFO - 2a03:2880:10ff:d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:09:31,242 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:09:31,243 - INFO - 2a03:2880:10ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:09:31,459 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:09:31,459 - INFO - 2a03:2880:10ff:40:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:10:13,242 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:10:13,242 - INFO - Received message from 919530251797: Dubai luggage bag price
2025-06-04 17:10:13,243 - INFO - 2a03:2880:10ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:10:13,244 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:10:16,250 - INFO - Processing batched messages for 919530251797: Dubai luggage bag price
2025-06-04 17:10:25,356 - INFO - Sent response to user 919530251797, seq 4.
2025-06-04 17:10:26,345 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:10:26,345 - INFO - 2a03:2880:22ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:10:26,591 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:10:26,592 - INFO - 2a03:2880:22ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:10:26,773 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:10:26,773 - INFO - 2a03:2880:22ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:10:37,739 - INFO - Shutting down
2025-06-04 17:10:37,847 - INFO - Waiting for application shutdown.
2025-06-04 17:10:37,848 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 17:10:37,885 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 17:10:37,886 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 17:10:37,886 - INFO - Application shutdown complete.
2025-06-04 17:10:37,887 - INFO - Finished server process [25800]
2025-06-04 17:10:37,887 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 17:10:37,888 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 17:11:33,468 - INFO - Starting WhatsApp FastAPI app
2025-06-04 17:11:33,564 - INFO - Started server process [27384]
2025-06-04 17:11:33,565 - INFO - Waiting for application startup.
2025-06-04 17:11:34,063 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 17:11:34,072 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 17:11:34,072 - INFO - Application startup complete.
2025-06-04 17:11:34,073 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 17:11:36,501 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:11:36,502 - INFO - Received message from 919530251797: Alexandria bag price
2025-06-04 17:11:36,502 - INFO - 2a03:2880:10ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:11:36,503 - INFO - Started message processing for user 919530251797
2025-06-04 17:11:39,519 - INFO - Processing batched messages for 919530251797: Alexandria bag price
2025-06-04 17:11:51,908 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 17:11:53,201 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:11:53,202 - INFO - 2a03:2880:12ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:11:53,218 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:11:53,219 - INFO - 2a03:2880:21ff:5f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:11:53,358 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:11:53,359 - INFO - 2a03:2880:10ff:c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:12:11,642 - INFO - Shutting down
2025-06-04 17:12:11,751 - INFO - Waiting for application shutdown.
2025-06-04 17:12:11,751 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 17:12:11,788 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 17:12:11,789 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 17:12:11,789 - INFO - Application shutdown complete.
2025-06-04 17:12:11,790 - INFO - Finished server process [27384]
2025-06-04 17:12:11,791 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 17:12:11,792 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 17:12:45,690 - INFO - Starting WhatsApp FastAPI app
2025-06-04 17:12:45,788 - INFO - Started server process [20548]
2025-06-04 17:12:45,789 - INFO - Waiting for application startup.
2025-06-04 17:12:46,193 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 17:12:46,200 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 17:12:46,200 - INFO - Application startup complete.
2025-06-04 17:12:46,201 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 17:13:10,154 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:13:10,155 - INFO - Received message from 919530251797: Antwarp price
2025-06-04 17:13:10,155 - INFO - 2a03:2880:10ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:13:10,156 - INFO - Started message processing for user 919530251797
2025-06-04 17:13:13,168 - INFO - Processing batched messages for 919530251797: Antwarp price
2025-06-04 17:13:30,810 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 17:13:31,829 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:13:31,829 - INFO - 2a03:2880:22ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:13:32,030 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:13:32,030 - INFO - 2a03:2880:10ff:a:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:13:32,215 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:13:32,215 - INFO - 2a03:2880:22ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:14:46,351 - INFO - Shutting down
2025-06-04 17:14:46,461 - INFO - Waiting for application shutdown.
2025-06-04 17:14:46,462 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 17:14:46,508 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 17:14:46,509 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 17:14:46,509 - INFO - Application shutdown complete.
2025-06-04 17:14:46,510 - INFO - Finished server process [20548]
2025-06-04 17:14:46,510 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 17:14:46,511 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 17:15:04,498 - INFO - Starting WhatsApp FastAPI app
2025-06-04 17:15:04,595 - INFO - Started server process [20508]
2025-06-04 17:15:04,596 - INFO - Waiting for application startup.
2025-06-04 17:15:05,040 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 17:15:05,045 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 17:15:05,046 - INFO - Application startup complete.
2025-06-04 17:15:05,047 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 17:15:05,898 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:15:05,899 - INFO - Received message from 919530251797: No i didn't get it
2025-06-04 17:15:05,899 - INFO - 2a03:2880:12ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:15:05,900 - INFO - Started message processing for user 919530251797
2025-06-04 17:15:08,909 - INFO - Processing batched messages for 919530251797: No i didn't get it
2025-06-04 17:15:20,204 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 17:15:21,229 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:15:21,230 - INFO - 2a03:2880:21ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:15:21,431 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:15:21,432 - INFO - 2a03:2880:10ff:40:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:15:21,595 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:15:21,595 - INFO - 2a03:2880:10ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:15:46,601 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:15:46,602 - INFO - Received message from 919530251797: What is your warranty policy
2025-06-04 17:15:46,603 - INFO - 2a03:2880:12ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:15:46,603 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:15:49,614 - INFO - Processing batched messages for 919530251797: What is your warranty policy
2025-06-04 17:15:59,432 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 17:16:00,397 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:16:00,398 - INFO - 2a03:2880:22ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:16:00,707 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:16:00,707 - INFO - 2a03:2880:22ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:16:00,925 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:16:00,925 - INFO - 2a03:2880:10ff:c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:16:12,850 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:16:12,850 - INFO - Received message from 919530251797: How to reset tsa lock
2025-06-04 17:16:12,850 - INFO - 2a03:2880:22ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:16:12,851 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:16:15,864 - INFO - Processing batched messages for 919530251797: How to reset tsa lock
2025-06-04 17:16:25,553 - INFO - Sent response to user 919530251797, seq 3.
2025-06-04 17:16:26,691 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:16:26,691 - INFO - 2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:16:27,060 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:16:27,060 - INFO - 2a03:2880:21ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:16:27,165 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:16:27,165 - INFO - 2a03:2880:10ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:16:54,658 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:16:54,659 - INFO - Received message from 919530251797: What is your shipping policiy and cancellation policy also
2025-06-04 17:16:54,659 - INFO - 2a03:2880:22ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:16:54,660 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:16:57,673 - INFO - Processing batched messages for 919530251797: What is your shipping policiy and cancellation policy also
2025-06-04 17:17:06,262 - INFO - Sent response to user 919530251797, seq 4.
2025-06-04 17:17:07,253 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:17:07,254 - INFO - 2a03:2880:21ff:a:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:17:07,570 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:17:07,570 - INFO - 2a03:2880:21ff:44:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:17:50,787 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:17:50,787 - INFO - Received message from 919530251797: I want to know refund status
2025-06-04 17:17:50,788 - INFO - 2a03:2880:21ff:47:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:17:50,789 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:17:53,795 - INFO - Processing batched messages for 919530251797: I want to know refund status
2025-06-04 17:17:58,980 - INFO - Sent response to user 919530251797, seq 5.
2025-06-04 17:18:00,024 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:18:00,025 - INFO - 2a03:2880:21ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:18:00,293 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:18:00,293 - INFO - 2a03:2880:10ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:18:00,504 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:18:00,505 - INFO - 2a03:2880:12ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:18:20,681 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:18:20,682 - INFO - Received message from 919530251797: NM56458
2025-06-04 17:18:20,682 - INFO - 2a03:2880:21ff:4d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:18:20,683 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:18:23,696 - INFO - Processing batched messages for 919530251797: NM56458
2025-06-04 17:18:28,159 - INFO - Sent response to user 919530251797, seq 6.
2025-06-04 17:18:29,283 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:18:29,283 - INFO - 2a03:2880:10ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:18:29,586 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:18:29,587 - INFO - 2a03:2880:12ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:18:29,747 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:18:29,747 - INFO - 2a03:2880:12ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:18:38,291 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:18:38,292 - INFO - Received message from 919530251797: Devilisback484@gmail.com
2025-06-04 17:18:38,292 - INFO - 2a03:2880:12ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:18:38,293 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:18:41,300 - INFO - Processing batched messages for 919530251797: Devilisback484@gmail.com
2025-06-04 17:18:48,786 - INFO - Sent response to user 919530251797, seq 7.
2025-06-04 17:18:49,865 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:18:49,866 - INFO - 2a03:2880:22ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:18:50,036 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:18:50,036 - INFO - 2a03:2880:21ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:18:50,121 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:18:50,121 - INFO - 2a03:2880:22ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:19:00,621 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:19:00,622 - INFO - Received message from 919530251797: devilisback484@gmail.com
2025-06-04 17:19:00,622 - INFO - 2a03:2880:22ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:19:00,623 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:19:03,629 - INFO - Processing batched messages for 919530251797: devilisback484@gmail.com
2025-06-04 17:19:11,908 - INFO - Sent response to user 919530251797, seq 8.
2025-06-04 17:19:12,884 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:19:12,884 - INFO - 2a03:2880:21ff:10:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:19:13,092 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:19:13,093 - INFO - 2a03:2880:21ff:e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:19:13,498 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:19:13,499 - INFO - 2a03:2880:12ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:20:11,847 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:20:11,847 - INFO - Received message from 919530251797: Nearby store chomu puliya, jaipur
2025-06-04 17:20:11,847 - INFO - 2a03:2880:10ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:20:11,848 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:20:14,854 - INFO - Processing batched messages for 919530251797: Nearby store chomu puliya, jaipur
2025-06-04 17:20:17,286 - WARNING - Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000002117E51C550>, 'Connection to nominatim.openstreetmap.org timed out. (connect timeout=1)')': /search?q=chomu+puliya%2C+jaipur&format=json&limit=1
2025-06-04 17:20:18,303 - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000002117E51CCD0>, 'Connection to nominatim.openstreetmap.org timed out. (connect timeout=1)')': /search?q=chomu+puliya%2C+jaipur&format=json&limit=1
2025-06-04 17:20:21,876 - INFO - Sent response to user 919530251797, seq 9.
2025-06-04 17:20:22,907 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:20:22,907 - INFO - 2a03:2880:22ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:20:23,185 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:20:23,186 - INFO - 2a03:2880:10ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:20:23,263 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:20:23,264 - INFO - 2a03:2880:10ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:22:25,147 - INFO - Shutting down
2025-06-04 17:22:25,258 - INFO - Waiting for application shutdown.
2025-06-04 17:22:25,259 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 17:22:25,300 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 17:22:25,301 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 17:22:25,301 - INFO - Application shutdown complete.
2025-06-04 17:22:25,302 - INFO - Finished server process [20508]
2025-06-04 17:22:25,302 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 17:22:25,302 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 17:22:43,571 - INFO - Starting WhatsApp FastAPI app
2025-06-04 17:22:43,667 - INFO - Started server process [13880]
2025-06-04 17:22:43,668 - INFO - Waiting for application startup.
2025-06-04 17:22:44,070 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 17:22:44,076 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 17:22:44,076 - INFO - Application startup complete.
2025-06-04 17:22:44,077 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 17:22:59,491 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:22:59,491 - INFO - Received message from 919530251797: Nearby store chomu puliya, jaipur
2025-06-04 17:22:59,492 - INFO - 2a03:2880:12ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:22:59,492 - INFO - Started message processing for user 919530251797
2025-06-04 17:23:02,504 - INFO - Processing batched messages for 919530251797: Nearby store chomu puliya, jaipur
2025-06-04 17:23:06,491 - WARNING - Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000001DD7D14C190>, 'Connection to nominatim.openstreetmap.org timed out. (connect timeout=1)')': /search?q=chomu+puliya%2C+jaipur&format=json&limit=1
2025-06-04 17:23:07,504 - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000001DD7D14E490>, 'Connection to nominatim.openstreetmap.org timed out. (connect timeout=1)')': /search?q=chomu+puliya%2C+jaipur&format=json&limit=1
2025-06-04 17:23:24,509 - ERROR - Error sending message to user 919530251797: {'error': {'message': "(#100) Param text['body'] must be at most 4096 characters long.", 'type': 'OAuthException', 'code': 100, 'fbtrace_id': 'ALxIPZIvxVH9yfMFftZMa0Q'}} (Status Code: 400)
2025-06-04 17:23:24,511 - ERROR - NoneType: None

2025-06-04 17:23:24,512 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 17:23:53,980 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:23:53,980 - INFO - Received message from 919530251797: Nearby store in sikar
2025-06-04 17:23:53,980 - INFO - 2a03:2880:10ff:40:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:23:53,981 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:23:56,996 - INFO - Processing batched messages for 919530251797: Nearby store in sikar
2025-06-04 17:23:59,706 - WARNING - Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000001DD7D14C410>, 'Connection to nominatim.openstreetmap.org timed out. (connect timeout=1)')': /search?q=sikar&format=json&limit=1
2025-06-04 17:24:00,713 - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000001DD7D14F4D0>, 'Connection to nominatim.openstreetmap.org timed out. (connect timeout=1)')': /search?q=sikar&format=json&limit=1
2025-06-04 17:24:04,584 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 17:24:05,624 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:24:05,624 - INFO - 2a03:2880:22ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:24:05,960 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:24:05,960 - INFO - 2a03:2880:21ff:47:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:24:06,002 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:24:06,002 - INFO - 2a03:2880:10ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:24:16,755 - INFO - Shutting down
2025-06-04 17:24:16,863 - INFO - Waiting for application shutdown.
2025-06-04 17:24:16,863 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 17:24:16,901 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 17:24:16,902 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 17:24:16,902 - INFO - Application shutdown complete.
2025-06-04 17:24:16,902 - INFO - Finished server process [13880]
2025-06-04 17:24:16,903 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 17:24:16,903 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 17:25:17,138 - INFO - Starting WhatsApp FastAPI app
2025-06-04 17:25:17,235 - INFO - Started server process [25080]
2025-06-04 17:25:17,236 - INFO - Waiting for application startup.
2025-06-04 17:25:17,820 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 17:25:17,828 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 17:25:17,829 - INFO - Application startup complete.
2025-06-04 17:25:17,829 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 17:25:29,920 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:25:29,921 - INFO - Received message from 919530251797: Kids collection
2025-06-04 17:25:29,921 - INFO - 2a03:2880:12ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:25:29,922 - INFO - Started message processing for user 919530251797
2025-06-04 17:25:32,925 - INFO - Processing batched messages for 919530251797: Kids collection
2025-06-04 17:25:39,744 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 17:25:40,975 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:25:40,975 - INFO - 2a03:2880:12ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:25:41,173 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:25:41,174 - INFO - 2a03:2880:12ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:25:41,337 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:25:41,337 - INFO - 2a03:2880:12ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:28:02,931 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-06-04 17:28:02,931 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 17:28:42,796 - INFO - Shutting down
2025-06-04 17:28:42,905 - INFO - Waiting for application shutdown.
2025-06-04 17:28:42,906 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 17:28:42,947 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 17:28:42,947 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 17:28:42,947 - INFO - Application shutdown complete.
2025-06-04 17:28:42,948 - INFO - Finished server process [25080]
2025-06-04 17:41:14,543 - INFO - Starting WhatsApp FastAPI app
2025-06-04 17:41:14,701 - INFO - Started server process [620]
2025-06-04 17:41:14,703 - INFO - Waiting for application startup.
2025-06-04 17:41:15,387 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 17:41:15,397 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 17:41:15,397 - INFO - Application startup complete.
2025-06-04 17:41:15,398 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 17:41:36,421 - INFO - Inserted new user in DB: 919530251797
2025-06-04 17:41:36,426 - INFO - Received message from 919530251797: Hello
2025-06-04 17:41:36,426 - INFO - 2a03:2880:21ff:f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:41:36,427 - INFO - Started message processing for user 919530251797
2025-06-04 17:41:39,434 - INFO - Processing batched messages for 919530251797: Hello
2025-06-04 17:41:43,245 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 17:41:44,344 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:41:44,345 - INFO - 2a03:2880:22ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:41:44,491 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:41:44,492 - INFO - 2a03:2880:21ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:41:44,630 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:41:44,631 - INFO - 2a03:2880:21ff:47:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:42:16,586 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:42:16,586 - INFO - Received message from 919530251797: I want to track my order
2025-06-04 17:42:16,587 - INFO - 2a03:2880:22ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:42:16,588 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:42:19,603 - INFO - Processing batched messages for 919530251797: I want to track my order
2025-06-04 17:42:22,230 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 17:42:23,371 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:42:23,371 - INFO - 2a03:2880:22ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:42:23,478 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:42:23,479 - INFO - 2a03:2880:12ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:42:23,497 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:42:23,498 - INFO - 2a03:2880:10ff:46:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:43:24,471 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:43:24,472 - INFO - Received message from 919530251797: Nm56460 samay.m2504@gmail
2025-06-04 17:43:24,472 - INFO - 2a03:2880:22ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:43:24,473 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:43:27,475 - INFO - Processing batched messages for 919530251797: Nm56460 samay.m2504@gmail
2025-06-04 17:43:33,451 - INFO - Sent response to user 919530251797, seq 3.
2025-06-04 17:43:34,675 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:43:34,676 - INFO - 2a03:2880:21ff:47:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:43:34,704 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:43:34,704 - INFO - 2a03:2880:21ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:43:34,936 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:43:34,936 - INFO - 2a03:2880:12ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:44:12,139 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:44:12,140 - INFO - Received message from 919530251797: Can u track this nm56234
2025-06-04 17:44:12,140 - INFO - 2a03:2880:21ff:b:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:44:12,141 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:44:15,146 - INFO - Processing batched messages for 919530251797: Can u track this nm56234
2025-06-04 17:44:25,933 - INFO - Extracted cp_id=4 from URL.
2025-06-04 17:44:29,028 - INFO - Sent response to user 919530251797, seq 4.
2025-06-04 17:44:30,069 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:44:30,069 - INFO - 2a03:2880:10ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:44:30,239 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:44:30,240 - INFO - 2a03:2880:21ff:40:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:44:30,490 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:44:30,491 - INFO - 2a03:2880:10ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:45:22,643 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:45:22,643 - INFO - Received message from 919530251797: I want to return my orde
2025-06-04 17:45:22,644 - INFO - 2a03:2880:21ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:45:22,645 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:45:25,661 - INFO - Processing batched messages for 919530251797: I want to return my orde
2025-06-04 17:45:28,926 - INFO - Sent response to user 919530251797, seq 5.
2025-06-04 17:45:29,963 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:45:29,964 - INFO - 2a03:2880:21ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:45:30,152 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:45:30,152 - INFO - 2a03:2880:10ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:46:20,390 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:46:20,390 - INFO - Received message from 919530251797: I want to exchange ny order
2025-06-04 17:46:20,391 - INFO - 2a03:2880:12ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:46:20,391 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:46:23,396 - INFO - Processing batched messages for 919530251797: I want to exchange ny order
2025-06-04 17:46:26,773 - INFO - Sent response to user 919530251797, seq 6.
2025-06-04 17:46:27,818 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:46:27,819 - INFO - 2a03:2880:10ff:a:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:46:28,004 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:46:28,005 - INFO - 2a03:2880:22ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:46:28,051 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:46:28,052 - INFO - 2a03:2880:10ff:a:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:46:43,388 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:46:43,389 - INFO - Received message from 919530251797: Discount offers
2025-06-04 17:46:43,389 - INFO - 2a03:2880:10ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:46:43,390 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:46:46,395 - INFO - Processing batched messages for 919530251797: Discount offers
2025-06-04 17:46:49,907 - INFO - Sent response to user 919530251797, seq 7.
2025-06-04 17:46:51,090 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:46:51,091 - INFO - 2a03:2880:10ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:46:51,092 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:46:51,093 - INFO - 2a03:2880:10ff:41:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:46:51,188 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:46:51,189 - INFO - 2a03:2880:22ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:46:57,083 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:46:58,265 - INFO - 2a03:2880:21ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:46:59,772 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:46:59,772 - INFO - 2a03:2880:22ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:46:59,903 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:46:59,903 - INFO - 2a03:2880:22ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:47:00,063 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:47:00,064 - INFO - 2a03:2880:10ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:47:09,905 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:47:10,816 - INFO - 2a03:2880:10ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:47:11,946 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:47:11,947 - INFO - 2a03:2880:10ff:c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:47:11,982 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:47:11,982 - INFO - 2a03:2880:22ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:47:12,095 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:47:12,096 - INFO - 2a03:2880:22ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:48:06,655 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:48:07,540 - INFO - 2a03:2880:21ff:56:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:48:08,846 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:48:08,847 - INFO - 2a03:2880:10ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:48:08,864 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:48:08,865 - INFO - 2a03:2880:12ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:48:08,910 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:48:08,910 - INFO - 2a03:2880:10ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:48:48,663 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:48:48,664 - INFO - Received message from 919530251797: 6monthsmore
2025-06-04 17:48:48,664 - INFO - 2a03:2880:10ff:48:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:48:48,665 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:48:51,672 - INFO - Processing batched messages for 919530251797: 6monthsmore
2025-06-04 17:48:55,496 - INFO - Sent response to user 919530251797, seq 8.
2025-06-04 17:48:56,538 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:48:56,538 - INFO - 2a03:2880:10ff:e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:48:56,836 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:48:56,836 - INFO - 2a03:2880:21ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:49:17,229 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:49:17,230 - INFO - Received message from 919530251797: Yes
2025-06-04 17:49:17,230 - INFO - 2a03:2880:12ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:49:17,231 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:49:20,238 - INFO - Processing batched messages for 919530251797: Yes
2025-06-04 17:49:22,618 - INFO - Sent response to user 919530251797, seq 9.
2025-06-04 17:49:23,759 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:49:23,760 - INFO - 2a03:2880:10ff:e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:49:23,876 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:49:23,876 - INFO - 2a03:2880:22ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:49:32,119 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:49:32,119 - INFO - Received image from 919530251797
2025-06-04 17:49:34,984 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/11efcf3f43634611993907cdf03cb362.jpg
2025-06-04 17:49:34,984 - INFO - 2a03:2880:22ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:49:34,985 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:49:38,002 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/11efcf3f43634611993907cdf03cb362.jpg
2025-06-04 17:49:46,628 - INFO - Sent response to user 919530251797, seq 10.
2025-06-04 17:49:47,645 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:49:47,646 - INFO - 2a03:2880:22ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:49:47,925 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:49:47,925 - INFO - 2a03:2880:22ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:50:16,794 - INFO - User 919530251797 found in Redis cache.
2025-06-04 17:50:16,794 - INFO - Received image from 919530251797
2025-06-04 17:50:20,137 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/fb0d5c24f6cc4ac4aaad38bf95a78dca.jpg
2025-06-04 17:50:20,137 - INFO - 2a03:2880:21ff:4b:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:50:20,138 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 17:50:23,154 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/fb0d5c24f6cc4ac4aaad38bf95a78dca.jpg
2025-06-04 17:50:31,638 - INFO - Sent response to user 919530251797, seq 11.
2025-06-04 17:50:32,846 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:50:32,846 - INFO - 2a03:2880:12ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:50:33,056 - WARNING - Webhook payload does not include a phone number.
2025-06-04 17:50:33,056 - INFO - 2a03:2880:10ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 17:52:53,158 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-06-04 17:52:53,159 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 17:59:41,811 - INFO - Shutting down
2025-06-04 17:59:41,920 - INFO - Waiting for application shutdown.
2025-06-04 17:59:41,921 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 17:59:41,961 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 17:59:41,962 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 17:59:41,962 - INFO - Application shutdown complete.
2025-06-04 17:59:41,963 - INFO - Finished server process [620]
2025-06-04 18:12:33,432 - INFO - Starting WhatsApp FastAPI app
2025-06-04 18:12:33,550 - INFO - Started server process [14248]
2025-06-04 18:12:33,551 - INFO - Waiting for application startup.
2025-06-04 18:12:34,122 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 18:12:34,133 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 18:12:34,134 - INFO - Application startup complete.
2025-06-04 18:12:34,135 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 18:13:44,402 - INFO - User 919530251797 found in Redis cache.
2025-06-04 18:13:44,403 - INFO - Received image from 919530251797
2025-06-04 18:13:47,550 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/b65eacc638dd4c798444a426782b6a4f.jpg
2025-06-04 18:13:47,551 - INFO - 2a03:2880:10ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 18:13:47,552 - INFO - Started message processing for user 919530251797
2025-06-04 18:13:50,569 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/b65eacc638dd4c798444a426782b6a4f.jpg
2025-06-04 18:14:00,096 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 18:14:01,223 - WARNING - Webhook payload does not include a phone number.
2025-06-04 18:14:01,223 - INFO - 2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 18:14:01,362 - WARNING - Webhook payload does not include a phone number.
2025-06-04 18:14:01,362 - INFO - 2a03:2880:10ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 18:14:01,554 - WARNING - Webhook payload does not include a phone number.
2025-06-04 18:14:01,554 - INFO - 2a03:2880:10ff:48:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 18:16:20,573 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-06-04 18:16:20,573 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 18:24:23,533 - INFO - Shutting down
2025-06-04 18:24:23,643 - INFO - Waiting for application shutdown.
2025-06-04 18:24:23,644 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 18:24:23,687 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 18:24:23,687 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 18:24:23,688 - INFO - Application shutdown complete.
2025-06-04 18:24:23,689 - INFO - Finished server process [14248]
2025-06-04 18:29:00,973 - INFO - Starting WhatsApp FastAPI app
2025-06-04 18:29:01,118 - INFO - Started server process [2964]
2025-06-04 18:29:01,120 - INFO - Waiting for application startup.
2025-06-04 18:29:01,568 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 18:29:01,581 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 18:29:01,582 - INFO - Application startup complete.
2025-06-04 18:29:01,583 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 18:29:18,186 - INFO - User 919530251797 found in Redis cache.
2025-06-04 18:29:18,186 - INFO - Received image from 919530251797
2025-06-04 18:29:22,238 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/6e6d4ae69b1544828691785c5c5e036b.jpg
2025-06-04 18:29:22,240 - INFO - 2a03:2880:21ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 18:29:22,243 - INFO - Started message processing for user 919530251797
2025-06-04 18:29:25,259 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/6e6d4ae69b1544828691785c5c5e036b.jpg
2025-06-04 18:29:36,459 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 18:29:37,581 - WARNING - Webhook payload does not include a phone number.
2025-06-04 18:29:37,582 - INFO - 2a03:2880:22ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 18:29:37,701 - WARNING - Webhook payload does not include a phone number.
2025-06-04 18:29:37,702 - INFO - 2a03:2880:10ff:a:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 18:31:55,262 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-06-04 18:31:55,264 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 18:36:39,311 - INFO - Shutting down
2025-06-04 18:36:39,420 - INFO - Waiting for application shutdown.
2025-06-04 18:36:39,422 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 18:36:39,464 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 18:36:39,465 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 18:36:39,465 - INFO - Application shutdown complete.
2025-06-04 18:36:39,466 - INFO - Finished server process [2964]
2025-06-04 18:55:31,341 - INFO - Starting WhatsApp FastAPI app
2025-06-04 18:55:31,449 - INFO - Started server process [26340]
2025-06-04 18:55:31,450 - INFO - Waiting for application startup.
2025-06-04 18:55:31,929 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 18:55:31,935 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 18:55:31,936 - INFO - Application startup complete.
2025-06-04 18:55:31,937 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 18:56:01,929 - INFO - Inserted new user in DB: 919530251797
2025-06-04 18:56:01,936 - INFO - Received message from 919530251797: Hi
2025-06-04 18:56:01,936 - INFO - 2a03:2880:21ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 18:56:01,938 - INFO - Started message processing for user 919530251797
2025-06-04 18:56:04,946 - INFO - Processing batched messages for 919530251797: Hi
2025-06-04 18:56:09,209 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 18:56:10,418 - WARNING - Webhook payload does not include a phone number.
2025-06-04 18:56:10,418 - INFO - 2a03:2880:10ff:f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 18:56:10,620 - WARNING - Webhook payload does not include a phone number.
2025-06-04 18:56:10,621 - INFO - 2a03:2880:10ff:44:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 18:56:10,626 - WARNING - Webhook payload does not include a phone number.
2025-06-04 18:56:10,627 - INFO - 2a03:2880:10ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 18:56:22,937 - INFO - User 919530251797 found in Redis cache.
2025-06-04 18:56:22,938 - INFO - Received message from 919530251797: I want to tracker my order
2025-06-04 18:56:22,938 - INFO - 2a03:2880:22ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 18:56:22,939 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 18:56:25,940 - INFO - Processing batched messages for 919530251797: I want to tracker my order
2025-06-04 18:56:28,941 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 18:56:30,184 - WARNING - Webhook payload does not include a phone number.
2025-06-04 18:56:30,185 - INFO - 2a03:2880:21ff:47:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 18:56:30,208 - WARNING - Webhook payload does not include a phone number.
2025-06-04 18:56:30,209 - INFO - 2a03:2880:22ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 18:56:30,300 - WARNING - Webhook payload does not include a phone number.
2025-06-04 18:56:30,301 - INFO - 2a03:2880:10ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 18:57:05,042 - INFO - Shutting down
2025-06-04 18:57:05,153 - INFO - Waiting for application shutdown.
2025-06-04 18:57:05,154 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 18:57:05,195 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 18:57:05,197 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 18:57:05,198 - INFO - Application shutdown complete.
2025-06-04 18:57:05,200 - INFO - Finished server process [26340]
2025-06-04 18:57:05,202 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 18:57:05,204 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 19:11:58,566 - INFO - Starting WhatsApp FastAPI app
2025-06-04 19:11:58,783 - INFO - Started server process [25780]
2025-06-04 19:11:58,785 - INFO - Waiting for application startup.
2025-06-04 19:11:59,420 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 19:11:59,435 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 19:11:59,436 - INFO - Application startup complete.
2025-06-04 19:11:59,437 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 19:12:20,259 - INFO - User 919530251797 found in Redis cache.
2025-06-04 19:12:20,259 - INFO - Received message from 919530251797: Order NM56460
samay.m2504@gmail.com
2025-06-04 19:12:20,260 - INFO - 2a03:2880:21ff:a:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:12:20,260 - INFO - Started message processing for user 919530251797
2025-06-04 19:12:23,274 - INFO - Processing batched messages for 919530251797: Order NM56460
samay.m2504@gmail.com
2025-06-04 19:12:29,358 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 19:12:30,610 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:12:30,611 - INFO - 2a03:2880:21ff:4d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:12:30,811 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:12:30,812 - INFO - 2a03:2880:12ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:14:19,793 - INFO - User 919530251797 found in Redis cache.
2025-06-04 19:14:19,794 - INFO - Received message from 919530251797: Pls retry with email
2025-06-04 19:14:19,794 - INFO - 2a03:2880:21ff:f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:14:19,795 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 19:14:22,796 - INFO - Processing batched messages for 919530251797: Pls retry with email
2025-06-04 19:14:29,678 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 19:14:30,732 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:14:30,733 - INFO - 2a03:2880:10ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:14:30,936 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:14:30,938 - INFO - 2a03:2880:10ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:14:31,017 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:14:31,017 - INFO - 2a03:2880:10ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:14:59,378 - INFO - User 919530251797 found in Redis cache.
2025-06-04 19:15:00,212 - INFO - 2a03:2880:21ff:4d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:15:01,151 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:15:01,151 - INFO - 2a03:2880:22ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:15:01,518 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:15:01,519 - INFO - 2a03:2880:22ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:15:01,570 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:15:01,571 - INFO - 2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:15:58,030 - INFO - User 919530251797 found in Redis cache.
2025-06-04 19:15:58,030 - INFO - Received document from 919530251797
2025-06-04 19:15:59,471 - INFO - User 919530251797 found in Redis cache.
2025-06-04 19:15:59,471 - INFO - Received document from 919530251797
2025-06-04 19:16:01,123 - INFO - User 919530251797 found in Redis cache.
2025-06-04 19:16:01,123 - INFO - Received document from 919530251797
2025-06-04 19:16:02,965 - INFO - User 919530251797 found in Redis cache.
2025-06-04 19:16:02,967 - INFO - Received document from 919530251797
2025-06-04 19:16:05,630 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/5d09e9a6c70a41329c3c3ca8e5f2508a.jpg
2025-06-04 19:16:05,632 - INFO - 2a03:2880:22ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:16:06,551 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/51b7805a595e4729bb367cc305c6c064
2025-06-04 19:16:06,553 - INFO - 2a03:2880:10ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:16:06,556 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 19:16:06,558 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 19:16:08,154 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/f786edb01bd34f8e866dc3aa851ee050.jpg
2025-06-04 19:16:08,155 - INFO - 2a03:2880:12ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:16:08,157 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 19:16:09,051 - INFO - 2a03:2880:21ff:47:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:16:10,198 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:16:10,198 - INFO - 2a03:2880:22ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:16:10,613 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:16:10,615 - INFO - 2a03:2880:10ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:16:10,720 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:16:10,721 - INFO - 2a03:2880:12ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:16:11,167 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/5d09e9a6c70a41329c3c3ca8e5f2508a.jpg https://storage.googleapis.com/nashermiles/uploads/51b7805a595e4729bb367cc305c6c064 https://storage.googleapis.com/nashermiles/uploads/f786edb01bd34f8e866dc3aa851ee050.jpg
2025-06-04 19:16:18,982 - INFO - Sent response to user 919530251797, seq 3.
2025-06-04 19:16:20,164 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:16:20,164 - INFO - 2a03:2880:21ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:16:20,238 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:16:20,239 - INFO - 2a03:2880:21ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:16:20,369 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:16:20,371 - INFO - 2a03:2880:22ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:17:37,019 - INFO - User 919530251797 found in Redis cache.
2025-06-04 19:17:37,878 - INFO - 2a03:2880:21ff:b:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:17:38,946 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:17:38,947 - INFO - 2a03:2880:21ff:d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:17:39,228 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:17:39,230 - INFO - 2a03:2880:10ff:f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:17:39,625 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:17:39,625 - INFO - 2a03:2880:12ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:18:41,174 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-06-04 19:18:41,176 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 19:19:52,573 - INFO - Shutting down
2025-06-04 19:19:52,684 - INFO - Waiting for application shutdown.
2025-06-04 19:19:52,686 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 19:19:52,733 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 19:19:52,734 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 19:19:52,736 - INFO - Application shutdown complete.
2025-06-04 19:19:52,737 - INFO - Finished server process [25780]
2025-06-04 19:20:12,353 - INFO - Starting WhatsApp FastAPI app
2025-06-04 19:20:12,564 - INFO - Started server process [17868]
2025-06-04 19:20:12,566 - INFO - Waiting for application startup.
2025-06-04 19:20:13,169 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 19:20:13,181 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 19:20:13,183 - INFO - Application startup complete.
2025-06-04 19:20:13,186 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 19:20:43,957 - INFO - User 919530251797 found in Redis cache.
2025-06-04 19:20:43,957 - INFO - Received message from 919530251797: Can u track this nm56291
2025-06-04 19:20:43,958 - INFO - 2a03:2880:21ff:4d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:20:43,958 - INFO - Started message processing for user 919530251797
2025-06-04 19:20:46,965 - INFO - Processing batched messages for 919530251797: Can u track this nm56291
2025-06-04 19:20:50,817 - INFO - Extracted cp_id=9 from URL.
2025-06-04 19:20:56,331 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 19:20:57,479 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:20:57,479 - INFO - 2a03:2880:21ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:20:57,537 - WARNING - Webhook payload does not include a phone number.
2025-06-04 19:20:57,537 - INFO - 2a03:2880:22ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 19:21:36,205 - INFO - Shutting down
2025-06-04 19:21:36,314 - INFO - Waiting for application shutdown.
2025-06-04 19:21:36,315 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 19:21:36,352 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 19:21:36,353 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 19:21:36,354 - INFO - Application shutdown complete.
2025-06-04 19:21:36,354 - INFO - Finished server process [17868]
2025-06-04 19:21:36,356 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 19:21:36,357 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 21:57:53,013 - INFO - Starting WhatsApp FastAPI app
2025-06-04 21:57:53,156 - INFO - Started server process [19160]
2025-06-04 21:57:53,157 - INFO - Waiting for application startup.
2025-06-04 21:57:55,809 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 21:57:55,899 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 21:57:55,899 - INFO - Application startup complete.
2025-06-04 21:57:55,900 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 22:03:27,372 - INFO - Inserted new user in DB: 919530251797
2025-06-04 22:03:27,379 - INFO - Received message from 919530251797: hi
2025-06-04 22:03:27,379 - INFO - 2a03:2880:22ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:03:27,380 - INFO - Started message processing for user 919530251797
2025-06-04 22:03:30,391 - INFO - Processing batched messages for 919530251797: hi
2025-06-04 22:03:34,544 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 22:03:35,764 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:03:35,764 - INFO - 2a03:2880:10ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:03:35,791 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:03:35,791 - INFO - 2a03:2880:22ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:03:37,343 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:03:37,344 - INFO - 2a03:2880:10ff:f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:03:42,956 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:03:42,956 - INFO - Received message from 919530251797: Can u track this nm56291
2025-06-04 22:03:42,957 - INFO - 2a03:2880:22ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:03:42,957 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:03:45,972 - INFO - Processing batched messages for 919530251797: Can u track this nm56291
2025-06-04 22:03:48,392 - INFO - Extracted cp_id=9 from URL.
2025-06-04 22:03:57,380 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 22:03:58,712 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:03:58,712 - INFO - 2a03:2880:12ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:03:58,714 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:03:58,715 - INFO - 2a03:2880:21ff:4d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:03:58,754 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:03:58,755 - INFO - 2a03:2880:21ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:04:29,302 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:04:29,302 - INFO - Received message from 919530251797: Can u track this nm56234
2025-06-04 22:04:29,303 - INFO - 2a03:2880:22ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:04:29,304 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:04:32,306 - INFO - Processing batched messages for 919530251797: Can u track this nm56234
2025-06-04 22:04:34,348 - INFO - Extracted cp_id=4 from URL.
2025-06-04 22:04:42,393 - INFO - Sent response to user 919530251797, seq 3.
2025-06-04 22:04:43,450 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:04:43,450 - INFO - 2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:04:43,690 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:04:43,690 - INFO - 2a03:2880:10ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:04:44,811 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:04:44,811 - INFO - 2a03:2880:10ff:f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:05:30,387 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:05:30,388 - INFO - Received message from 919530251797: NM56460
2025-06-04 22:05:30,388 - INFO - 2a03:2880:10ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:05:30,389 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:05:33,397 - INFO - Processing batched messages for 919530251797: NM56460
2025-06-04 22:05:38,233 - INFO - Sent response to user 919530251797, seq 4.
2025-06-04 22:05:39,301 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:05:39,302 - INFO - 2a03:2880:22ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:05:39,461 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:05:39,461 - INFO - 2a03:2880:10ff:c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:05:39,660 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:05:39,660 - INFO - 2a03:2880:10ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:06:18,010 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:06:18,010 - INFO - Received message from 919530251797: I want warranty extension
2025-06-04 22:06:18,011 - INFO - 2a03:2880:12ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:06:18,011 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:06:21,020 - INFO - Processing batched messages for 919530251797: I want warranty extension
2025-06-04 22:06:23,415 - INFO - Sent response to user 919530251797, seq 5.
2025-06-04 22:06:24,614 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:06:24,614 - INFO - 2a03:2880:21ff:10:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:06:24,891 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:06:24,891 - INFO - 2a03:2880:21ff:f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:06:26,049 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:06:26,050 - INFO - 2a03:2880:10ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:06:34,217 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:06:34,217 - INFO - Received message from 919530251797: rahul20@gmail.com
2025-06-04 22:06:34,217 - INFO - 2a03:2880:10ff:46:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:06:34,218 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:06:37,228 - INFO - Processing batched messages for 919530251797: rahul20@gmail.com
2025-06-04 22:06:39,516 - INFO - Sent response to user 919530251797, seq 6.
2025-06-04 22:06:40,485 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:06:40,486 - INFO - 2a03:2880:22ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:06:40,674 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:06:40,674 - INFO - 2a03:2880:22ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:06:40,919 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:06:40,919 - INFO - 2a03:2880:21ff:40:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:07:07,252 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:07:07,253 - INFO - Received document from 919530251797
2025-06-04 22:07:10,391 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/b2ab9c75db9240eaa3c7507ad059f646.jpg
2025-06-04 22:07:10,392 - INFO - 2a03:2880:10ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:07:10,392 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:07:13,402 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/b2ab9c75db9240eaa3c7507ad059f646.jpg
2025-06-04 22:07:21,380 - INFO - Sent response to user 919530251797, seq 7.
2025-06-04 22:07:22,432 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:07:22,432 - INFO - 2a03:2880:22ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:07:22,621 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:07:22,622 - INFO - 2a03:2880:10ff:47:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:07:23,613 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:07:23,613 - INFO - 2a03:2880:10ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:09:09,561 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:09:09,561 - INFO - Received image from 919530251797
2025-06-04 22:09:12,845 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/6080e1d54ef9442bbb77c8aea7d0fe2b.jpg
2025-06-04 22:09:12,846 - INFO - 2a03:2880:22ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:09:12,846 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:09:15,856 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/6080e1d54ef9442bbb77c8aea7d0fe2b.jpg
2025-06-04 22:09:22,450 - INFO - Sent response to user 919530251797, seq 8.
2025-06-04 22:09:23,487 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:09:23,487 - INFO - 2a03:2880:10ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:09:23,752 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:09:23,752 - INFO - 2a03:2880:21ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:09:44,306 - INFO - Shutting down
2025-06-04 22:09:44,416 - INFO - Waiting for application shutdown.
2025-06-04 22:09:44,416 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 22:09:44,460 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 22:09:44,461 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 22:09:44,461 - INFO - Application shutdown complete.
2025-06-04 22:09:44,462 - INFO - Finished server process [19160]
2025-06-04 22:09:44,462 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 22:09:44,463 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 22:10:25,607 - INFO - Starting WhatsApp FastAPI app
2025-06-04 22:10:25,719 - INFO - Started server process [3920]
2025-06-04 22:10:25,720 - INFO - Waiting for application startup.
2025-06-04 22:10:26,292 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 22:10:26,306 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 22:10:26,306 - INFO - Application startup complete.
2025-06-04 22:10:26,307 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 22:10:45,322 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:10:45,323 - INFO - Received image from 919530251797
2025-06-04 22:10:48,453 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/781d902eda46494da55d6b642b7ab4a7.jpg
2025-06-04 22:10:48,453 - INFO - 2a03:2880:21ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:10:48,454 - INFO - Started message processing for user 919530251797
2025-06-04 22:10:51,459 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/781d902eda46494da55d6b642b7ab4a7.jpg
2025-06-04 22:11:05,098 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 22:11:06,080 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:11:06,080 - INFO - 2a03:2880:21ff:46:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:11:06,497 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:11:06,497 - INFO - 2a03:2880:10ff:49:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:12:47,828 - INFO - Shutting down
2025-06-04 22:12:47,937 - INFO - Waiting for application shutdown.
2025-06-04 22:12:47,938 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 22:12:47,980 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 22:12:47,981 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 22:12:47,981 - INFO - Application shutdown complete.
2025-06-04 22:12:47,981 - INFO - Finished server process [3920]
2025-06-04 22:12:47,982 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 22:12:47,982 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 22:13:29,373 - INFO - Starting WhatsApp FastAPI app
2025-06-04 22:13:29,478 - INFO - Started server process [15208]
2025-06-04 22:13:29,479 - INFO - Waiting for application startup.
2025-06-04 22:13:29,976 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 22:13:29,984 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 22:13:29,985 - INFO - Application startup complete.
2025-06-04 22:13:29,986 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 22:13:52,344 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:13:52,344 - INFO - Received image from 919530251797
2025-06-04 22:13:56,103 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/cff60325b24342a2b3a3122725154ed7.jpg
2025-06-04 22:13:56,104 - INFO - 2a03:2880:21ff:5f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:13:56,105 - INFO - Started message processing for user 919530251797
2025-06-04 22:13:59,117 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/cff60325b24342a2b3a3122725154ed7.jpg
2025-06-04 22:14:10,174 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 22:14:11,276 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:14:11,276 - INFO - 2a03:2880:10ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:14:11,409 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:14:11,410 - INFO - 2a03:2880:22ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:16:05,928 - INFO - Shutting down
2025-06-04 22:16:06,038 - INFO - Waiting for application shutdown.
2025-06-04 22:16:06,039 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 22:16:06,082 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 22:16:06,082 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 22:16:06,083 - INFO - Application shutdown complete.
2025-06-04 22:16:06,083 - INFO - Finished server process [15208]
2025-06-04 22:16:06,083 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 22:16:06,084 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 22:18:23,238 - INFO - Starting WhatsApp FastAPI app
2025-06-04 22:18:23,340 - INFO - Started server process [26192]
2025-06-04 22:18:23,341 - INFO - Waiting for application startup.
2025-06-04 22:18:25,106 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 22:18:25,116 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 22:18:25,117 - INFO - Application startup complete.
2025-06-04 22:18:25,117 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 22:19:39,844 - INFO - Inserted new user in DB: 919530251797
2025-06-04 22:19:39,848 - INFO - Received message from 919530251797: hi
2025-06-04 22:19:39,849 - INFO - 2a03:2880:10ff:a:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:19:39,850 - INFO - Started message processing for user 919530251797
2025-06-04 22:19:42,854 - INFO - Processing batched messages for 919530251797: hi
2025-06-04 22:19:46,749 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 22:19:47,835 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:19:47,836 - INFO - 2a03:2880:10ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:19:47,947 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:19:47,948 - INFO - 2a03:2880:10ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:19:53,862 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:19:53,862 - INFO - Received image from 919530251797
2025-06-04 22:19:56,958 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/ff7c74c828644fc286e55d1a962697fd.jpg
2025-06-04 22:19:56,960 - INFO - 2a03:2880:22ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:19:56,961 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:19:59,974 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/ff7c74c828644fc286e55d1a962697fd.jpg
2025-06-04 22:20:04,015 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 22:20:05,043 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:20:05,043 - INFO - 2a03:2880:10ff:47:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:20:05,293 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:20:05,293 - INFO - 2a03:2880:10ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:20:05,464 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:20:05,464 - INFO - 2a03:2880:12ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:20:31,908 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:20:31,909 - INFO - Received message from 919530251797: I need warranty extension above is my invoice
2025-06-04 22:20:31,909 - INFO - 2a03:2880:22ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:20:31,910 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:20:34,916 - INFO - Processing batched messages for 919530251797: I need warranty extension above is my invoice
2025-06-04 22:20:37,354 - INFO - Sent response to user 919530251797, seq 3.
2025-06-04 22:20:38,389 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:20:38,390 - INFO - 2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:20:38,567 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:20:38,567 - INFO - 2a03:2880:10ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:20:38,809 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:20:38,809 - INFO - 2a03:2880:21ff:55:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:20:49,923 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:20:49,923 - INFO - Received message from 919530251797: Rahul@gmail.com
2025-06-04 22:20:49,924 - INFO - 2a03:2880:21ff:c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:20:49,924 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:20:52,940 - INFO - Processing batched messages for 919530251797: Rahul@gmail.com
2025-06-04 22:21:01,829 - INFO - Sent response to user 919530251797, seq 4.
2025-06-04 22:21:02,876 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:21:02,877 - INFO - 2a03:2880:10ff:45:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:21:03,082 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:21:03,083 - INFO - 2a03:2880:22ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:21:44,027 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:21:44,027 - INFO - Received image from 919530251797
2025-06-04 22:21:46,923 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/ae32a5d3c7314abdb5a2a20cefc86e07.jpg
2025-06-04 22:21:46,924 - INFO - 2a03:2880:10ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:21:46,925 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:21:49,927 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/ae32a5d3c7314abdb5a2a20cefc86e07.jpg
2025-06-04 22:21:56,441 - INFO - Sent response to user 919530251797, seq 5.
2025-06-04 22:21:57,486 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:21:57,486 - INFO - 2a03:2880:10ff:43:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:21:57,735 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:21:57,735 - INFO - 2a03:2880:21ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:22:26,372 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:22:26,372 - INFO - Received image from 919530251797
2025-06-04 22:22:29,375 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/ac05cabedc404f05900b8600f6da13e0.jpg
2025-06-04 22:22:29,376 - INFO - 2a03:2880:10ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:22:29,377 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:22:32,392 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/ac05cabedc404f05900b8600f6da13e0.jpg
2025-06-04 22:22:38,857 - INFO - Sent response to user 919530251797, seq 6.
2025-06-04 22:22:39,834 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:22:39,834 - INFO - 2a03:2880:21ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:22:40,101 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:22:40,101 - INFO - 2a03:2880:10ff:45:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:23:06,361 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:23:06,362 - INFO - Received image from 919530251797
2025-06-04 22:23:09,475 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/80bf750d4a2b4a2c95f8fc13b65b3920.jpg
2025-06-04 22:23:09,475 - INFO - 2a03:2880:10ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:23:09,476 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:23:12,487 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/80bf750d4a2b4a2c95f8fc13b65b3920.jpg
2025-06-04 22:23:19,582 - INFO - Sent response to user 919530251797, seq 7.
2025-06-04 22:23:20,620 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:23:20,620 - INFO - 2a03:2880:10ff:b:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:23:20,955 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:23:20,955 - INFO - 2a03:2880:10ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:23:21,173 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:23:21,174 - INFO - 2a03:2880:22ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:23:37,955 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:23:37,955 - INFO - Received image from 919530251797
2025-06-04 22:23:40,957 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/f6212d77b3e94d1797a6c347e9d06dd0.jpg
2025-06-04 22:23:40,957 - INFO - 2a03:2880:10ff:44:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:23:40,958 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:23:43,974 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/f6212d77b3e94d1797a6c347e9d06dd0.jpg
2025-06-04 22:23:51,807 - INFO - Sent response to user 919530251797, seq 8.
2025-06-04 22:23:53,001 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:23:53,001 - INFO - 2a03:2880:10ff:b:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:23:53,082 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:23:53,082 - INFO - 2a03:2880:12ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:23:53,181 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:23:53,182 - INFO - 2a03:2880:10ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:25:49,535 - INFO - Shutting down
2025-06-04 22:25:49,648 - INFO - Waiting for application shutdown.
2025-06-04 22:25:49,648 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 22:25:49,693 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 22:25:49,693 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 22:25:49,694 - INFO - Application shutdown complete.
2025-06-04 22:25:49,694 - INFO - Finished server process [26192]
2025-06-04 22:25:49,695 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 22:25:49,695 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 22:28:58,083 - INFO - Starting WhatsApp FastAPI app
2025-06-04 22:28:58,312 - INFO - Started server process [20768]
2025-06-04 22:28:58,314 - INFO - Waiting for application startup.
2025-06-04 22:28:58,964 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 22:28:58,972 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 22:28:58,973 - INFO - Application startup complete.
2025-06-04 22:28:58,974 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 22:29:49,265 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:29:49,266 - INFO - Received message from 919530251797: hi
2025-06-04 22:29:49,266 - INFO - 2a03:2880:21ff:4c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:29:49,267 - INFO - Started message processing for user 919530251797
2025-06-04 22:29:52,275 - INFO - Processing batched messages for 919530251797: hi
2025-06-04 22:29:56,037 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 22:29:57,262 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:29:57,262 - INFO - 2a03:2880:10ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:29:57,298 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:29:57,298 - INFO - 2a03:2880:12ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:29:57,617 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:29:57,618 - INFO - 2a03:2880:12ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:30:31,566 - INFO - Inserted new user in DB: 919530251797
2025-06-04 22:30:31,568 - INFO - Received message from 919530251797: hello whatsup
2025-06-04 22:30:31,569 - INFO - 2a03:2880:22ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:30:31,569 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:30:34,573 - INFO - Processing batched messages for 919530251797: hello whatsup
2025-06-04 22:30:36,777 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 22:30:37,713 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:30:37,714 - INFO - 2a03:2880:21ff:c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:30:37,982 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:30:37,982 - INFO - 2a03:2880:22ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:30:38,073 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:30:38,073 - INFO - 2a03:2880:22ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:30:48,382 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:30:48,382 - INFO - Received message from 919530251797: so u ai bot right
2025-06-04 22:30:48,382 - INFO - 2a03:2880:10ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:30:48,383 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:30:51,390 - INFO - Processing batched messages for 919530251797: so u ai bot right
2025-06-04 22:30:53,892 - INFO - Sent response to user 919530251797, seq 3.
2025-06-04 22:30:54,973 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:30:54,974 - INFO - 2a03:2880:21ff:45:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:30:55,133 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:30:55,133 - INFO - 2a03:2880:21ff:46:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:30:55,242 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:30:55,242 - INFO - 2a03:2880:21ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:31:13,088 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:31:13,088 - INFO - Received message from 919530251797: tel me 2+10+65 how much
2025-06-04 22:31:13,089 - INFO - 2a03:2880:10ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:31:13,090 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:31:16,095 - INFO - Processing batched messages for 919530251797: tel me 2+10+65 how much
2025-06-04 22:31:18,259 - INFO - Sent response to user 919530251797, seq 4.
2025-06-04 22:31:19,263 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:31:19,263 - INFO - 2a03:2880:21ff:46:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:31:19,379 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:31:19,380 - INFO - 2a03:2880:21ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:31:19,820 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:31:19,821 - INFO - 2a03:2880:12ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:31:41,102 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:31:41,102 - INFO - Received image from 919530251797
2025-06-04 22:31:44,203 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/364adc43ff5d4a208390a40983cde6e9.jpg
2025-06-04 22:31:44,203 - INFO - 2a03:2880:22ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:31:44,204 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:31:47,208 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/364adc43ff5d4a208390a40983cde6e9.jpg
2025-06-04 22:31:49,748 - INFO - Sent response to user 919530251797, seq 5.
2025-06-04 22:31:50,730 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:31:50,731 - INFO - 2a03:2880:10ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:31:50,972 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:31:50,973 - INFO - 2a03:2880:21ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:31:51,211 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:31:51,212 - INFO - 2a03:2880:12ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:32:24,604 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:32:24,605 - INFO - Received message from 919530251797: I want warranty extension
2025-06-04 22:32:24,605 - INFO - 2a03:2880:10ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:32:24,606 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:32:27,613 - INFO - Processing batched messages for 919530251797: I want warranty extension
2025-06-04 22:32:30,391 - INFO - Sent response to user 919530251797, seq 6.
2025-06-04 22:32:31,480 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:32:31,480 - INFO - 2a03:2880:10ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:32:31,668 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:32:31,668 - INFO - 2a03:2880:10ff:c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:32:32,270 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:32:32,270 - INFO - 2a03:2880:21ff:42:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:32:39,759 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:32:39,759 - INFO - Received message from 919530251797: Rahul@gmail.com
2025-06-04 22:32:39,760 - INFO - 2a03:2880:12ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:32:39,760 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:32:42,767 - INFO - Processing batched messages for 919530251797: Rahul@gmail.com
2025-06-04 22:32:51,622 - INFO - Sent response to user 919530251797, seq 7.
2025-06-04 22:32:52,634 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:32:52,635 - INFO - 2a03:2880:10ff:47:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:32:52,855 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:32:52,856 - INFO - 2a03:2880:21ff:47:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:32:53,473 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:32:53,473 - INFO - 2a03:2880:12ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:33:08,144 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:33:08,145 - INFO - Received image from 919530251797
2025-06-04 22:33:11,389 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/76f2292d62304b48a2c266e2a6dd47d6.jpg
2025-06-04 22:33:11,390 - INFO - 2a03:2880:10ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:33:11,391 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:33:14,407 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/76f2292d62304b48a2c266e2a6dd47d6.jpg
2025-06-04 22:33:21,019 - INFO - Sent response to user 919530251797, seq 8.
2025-06-04 22:33:22,061 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:33:22,062 - INFO - 2a03:2880:21ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:33:22,271 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:33:22,271 - INFO - 2a03:2880:21ff:43:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:33:22,495 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:33:22,495 - INFO - 2a03:2880:12ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:33:28,250 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:33:28,250 - INFO - Received image from 919530251797
2025-06-04 22:33:31,352 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/47ad6a11e41e4283a4bdf1a3f3258231.jpg
2025-06-04 22:33:31,352 - INFO - 2a03:2880:22ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:33:31,353 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:33:34,362 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/47ad6a11e41e4283a4bdf1a3f3258231.jpg
2025-06-04 22:33:40,961 - INFO - Sent response to user 919530251797, seq 9.
2025-06-04 22:33:42,107 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:33:42,107 - INFO - 2a03:2880:12ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:33:42,185 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:33:42,186 - INFO - 2a03:2880:10ff:47:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:33:42,589 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:33:42,589 - INFO - 2a03:2880:10ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:33:49,916 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:33:49,916 - INFO - Received image from 919530251797
2025-06-04 22:33:52,884 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/17cbe5a37aec48329eaf1d646d42d397.jpg
2025-06-04 22:33:52,884 - INFO - 2a03:2880:12ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:33:52,885 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:33:55,890 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/17cbe5a37aec48329eaf1d646d42d397.jpg
2025-06-04 22:34:03,515 - INFO - Sent response to user 919530251797, seq 10.
2025-06-04 22:34:04,531 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:34:04,531 - INFO - 2a03:2880:10ff:74:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:34:05,083 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:34:05,084 - INFO - 2a03:2880:12ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:34:05,207 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:34:05,207 - INFO - 2a03:2880:21ff:7c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:34:12,769 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:34:12,769 - INFO - Received image from 919530251797
2025-06-04 22:34:15,785 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/ee71e0d344014010b4d69559b2523d1a.jpg
2025-06-04 22:34:15,785 - INFO - 2a03:2880:22ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:34:15,786 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:34:18,800 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/ee71e0d344014010b4d69559b2523d1a.jpg
2025-06-04 22:34:21,570 - INFO - Sent response to user 919530251797, seq 11.
2025-06-04 22:34:22,518 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:34:22,519 - INFO - 2a03:2880:21ff:4c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:34:22,691 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:34:22,691 - INFO - 2a03:2880:22ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:34:23,031 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:34:23,032 - INFO - 2a03:2880:10ff:d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:35:03,282 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:35:03,282 - INFO - Received message from 919530251797: I want to cancel my order
2025-06-04 22:35:03,282 - INFO - 2a03:2880:12ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:35:03,283 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:35:06,295 - INFO - Processing batched messages for 919530251797: I want to cancel my order
2025-06-04 22:35:08,880 - INFO - Sent response to user 919530251797, seq 12.
2025-06-04 22:35:09,875 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:35:09,876 - INFO - 2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:35:10,237 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:35:10,237 - INFO - 2a03:2880:10ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:35:10,522 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:35:10,523 - INFO - 2a03:2880:12ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:35:47,730 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:35:47,731 - INFO - Received message from 919530251797: Order NM56460
I don't want it now
2025-06-04 22:35:47,731 - INFO - 2a03:2880:21ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:35:47,732 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:35:50,746 - INFO - Processing batched messages for 919530251797: Order NM56460
I don't want it now
2025-06-04 22:35:54,511 - INFO - Sent response to user 919530251797, seq 13.
2025-06-04 22:35:55,498 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:35:55,498 - INFO - 2a03:2880:21ff:45:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:35:55,791 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:35:55,791 - INFO - 2a03:2880:21ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:36:08,549 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:36:08,549 - INFO - Received message from 919530251797: samay.m2504@gmail.com
2025-06-04 22:36:08,550 - INFO - 2a03:2880:22ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:36:08,550 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:36:11,560 - INFO - Processing batched messages for 919530251797: samay.m2504@gmail.com
2025-06-04 22:36:17,752 - INFO - Sent response to user 919530251797, seq 14.
2025-06-04 22:36:18,801 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:36:18,801 - INFO - 2a03:2880:21ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:36:18,982 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:36:18,982 - INFO - 2a03:2880:22ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:38:23,835 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:38:23,836 - INFO - Received message from 919530251797: Nasher MilesThank you for your purchase!
Order NM56472
I want to cancel this
2025-06-04 22:38:23,837 - INFO - 2a03:2880:22ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:38:23,837 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:38:26,840 - INFO - Processing batched messages for 919530251797: Nasher MilesThank you for your purchase!
Order NM56472
I want to cancel this
2025-06-04 22:38:30,858 - INFO - Sent response to user 919530251797, seq 15.
2025-06-04 22:38:31,867 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:38:31,867 - INFO - 2a03:2880:22ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:38:32,273 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:38:32,273 - INFO - 2a03:2880:12ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:38:38,889 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:38:38,889 - INFO - Received message from 919530251797: devilisback484@gmail.com
2025-06-04 22:38:38,890 - INFO - 2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:38:38,890 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:38:41,892 - INFO - Processing batched messages for 919530251797: devilisback484@gmail.com
2025-06-04 22:38:50,304 - INFO - Sent response to user 919530251797, seq 16.
2025-06-04 22:38:51,318 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:38:51,319 - INFO - 2a03:2880:10ff:7d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:38:51,535 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:38:51,535 - INFO - 2a03:2880:10ff:73:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:38:51,821 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:38:51,822 - INFO - 2a03:2880:21ff:55:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:39:20,653 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:39:20,654 - INFO - Received message from 919530251797: i want to know refund status of order canceled
2025-06-04 22:39:20,654 - INFO - 2a03:2880:22ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:39:20,655 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:39:23,664 - INFO - Processing batched messages for 919530251797: i want to know refund status of order canceled
2025-06-04 22:39:32,923 - INFO - Sent response to user 919530251797, seq 17.
2025-06-04 22:39:33,989 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:39:33,989 - INFO - 2a03:2880:10ff:46:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:39:34,360 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:39:34,360 - INFO - 2a03:2880:22ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:39:35,239 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:39:35,239 - INFO - 2a03:2880:22ff:6:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:40:22,945 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:40:22,946 - INFO - Received message from 919530251797: can you track the above canceled order
2025-06-04 22:40:22,946 - INFO - 2a03:2880:12ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:40:22,947 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:40:25,959 - INFO - Processing batched messages for 919530251797: can you track the above canceled order
2025-06-04 22:40:31,892 - INFO - Sent response to user 919530251797, seq 18.
2025-06-04 22:40:32,926 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:40:32,926 - INFO - 2a03:2880:21ff:e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:40:33,301 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:40:33,302 - INFO - 2a03:2880:22ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:40:34,649 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:40:34,650 - INFO - 2a03:2880:10ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:41:00,788 - INFO - Shutting down
2025-06-04 22:41:00,898 - INFO - Waiting for application shutdown.
2025-06-04 22:41:00,899 - INFO - Shutting down server and ngrok tunnel...
2025-06-04 22:41:00,936 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-04 22:41:00,936 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-04 22:41:00,937 - INFO - Application shutdown complete.
2025-06-04 22:41:00,937 - INFO - Finished server process [20768]
2025-06-04 22:41:00,938 - INFO - Processing task for user 919530251797 was cancelled.
2025-06-04 22:41:00,939 - INFO - Cleaned up processing task for user 919530251797.
2025-06-04 22:41:21,327 - INFO - Starting WhatsApp FastAPI app
2025-06-04 22:41:21,452 - INFO - Started server process [26592]
2025-06-04 22:41:21,453 - INFO - Waiting for application startup.
2025-06-04 22:41:21,989 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-04 22:41:21,999 - INFO - Starting the FastAPI app with lifespan.
2025-06-04 22:41:21,999 - INFO - Application startup complete.
2025-06-04 22:41:22,000 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-04 22:41:26,187 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:41:26,187 - INFO - Received message from 919530251797: can you check now please
2025-06-04 22:41:26,188 - INFO - 2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:41:26,189 - INFO - Started message processing for user 919530251797
2025-06-04 22:41:29,194 - INFO - Processing batched messages for 919530251797: can you check now please
2025-06-04 22:41:35,237 - INFO - Sent response to user 919530251797, seq 1.
2025-06-04 22:41:36,258 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:41:36,259 - INFO - 2a03:2880:21ff:5f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:41:36,640 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:41:36,641 - INFO - 2a03:2880:12ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:41:37,493 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:41:37,493 - INFO - 2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:42:37,665 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:42:37,665 - INFO - Received message from 919530251797: i have received damaged item
2025-06-04 22:42:37,666 - INFO - 2a03:2880:10ff:40:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:42:37,667 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:42:40,674 - INFO - Processing batched messages for 919530251797: i have received damaged item
2025-06-04 22:42:43,875 - INFO - Sent response to user 919530251797, seq 2.
2025-06-04 22:42:44,931 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:42:44,931 - INFO - 2a03:2880:10ff:40:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:42:45,221 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:42:45,222 - INFO - 2a03:2880:22ff:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:42:45,254 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:42:45,255 - INFO - 2a03:2880:10ff:c:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:43:05,309 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:43:05,309 - INFO - Received message from 919530251797: yes
2025-06-04 22:43:05,310 - INFO - 2a03:2880:10ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:43:05,310 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:43:08,319 - INFO - Processing batched messages for 919530251797: yes
2025-06-04 22:43:10,895 - INFO - Sent response to user 919530251797, seq 3.
2025-06-04 22:43:12,143 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:43:12,143 - INFO - 2a03:2880:21ff:47:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:43:12,255 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:43:12,255 - INFO - 2a03:2880:12ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:43:13,359 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:43:13,359 - INFO - 2a03:2880:21ff:5f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:43:17,562 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:43:17,562 - INFO - Received message from 919530251797: medium
2025-06-04 22:43:17,563 - INFO - 2a03:2880:21ff:5f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:43:17,563 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:43:20,578 - INFO - Processing batched messages for 919530251797: medium
2025-06-04 22:43:23,174 - INFO - Sent response to user 919530251797, seq 4.
2025-06-04 22:43:24,377 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:43:24,378 - INFO - 2a03:2880:22ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:43:24,406 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:43:24,407 - INFO - 2a03:2880:12ff:4:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:43:24,636 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:43:24,637 - INFO - 2a03:2880:22ff:70:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:43:38,089 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:43:38,090 - INFO - Received image from 919530251797
2025-06-04 22:43:41,212 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/1853141fee9644c9b9d45a4e873636bc.jpg
2025-06-04 22:43:41,213 - INFO - 2a03:2880:12ff:8:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:43:41,213 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:43:44,218 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/1853141fee9644c9b9d45a4e873636bc.jpg
2025-06-04 22:43:52,205 - INFO - Sent response to user 919530251797, seq 5.
2025-06-04 22:43:53,283 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:43:53,284 - INFO - 2a03:2880:10ff:45:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:43:53,372 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:43:53,373 - INFO - 2a03:2880:22ff:2:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:43:54,497 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:43:54,497 - INFO - 2a03:2880:22ff:9:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:44:16,812 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:44:16,812 - INFO - Received image from 919530251797
2025-06-04 22:44:19,785 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/7fc37bff8bbc4f7b8a9fc28d07567201.jpg
2025-06-04 22:44:19,786 - INFO - 2a03:2880:22ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:44:19,787 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:44:22,801 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/7fc37bff8bbc4f7b8a9fc28d07567201.jpg
2025-06-04 22:44:28,882 - INFO - Sent response to user 919530251797, seq 6.
2025-06-04 22:44:30,096 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:44:30,097 - INFO - 2a03:2880:22ff:7:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:44:30,388 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:44:30,388 - INFO - 2a03:2880:21ff:42:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:44:31,510 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:44:31,510 - INFO - 2a03:2880:10ff:d:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:44:48,836 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:44:48,836 - INFO - Received image from 919530251797
2025-06-04 22:44:51,898 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/bac7ad066b354f8cb4fdfaf71ef2a755.jpg
2025-06-04 22:44:51,898 - INFO - 2a03:2880:10ff:45:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:44:51,899 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:44:54,908 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/bac7ad066b354f8cb4fdfaf71ef2a755.jpg
2025-06-04 22:45:01,225 - INFO - Sent response to user 919530251797, seq 7.
2025-06-04 22:45:02,544 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:45:02,544 - INFO - 2a03:2880:12ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:45:02,637 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:45:02,637 - INFO - 2a03:2880:10ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:45:03,745 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:45:03,745 - INFO - 2a03:2880:10ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:45:25,098 - INFO - User 919530251797 found in Redis cache.
2025-06-04 22:45:25,098 - INFO - Received image from 919530251797
2025-06-04 22:45:28,168 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles/uploads/793b5f9c63c945a58fbe087af8f8d61e.jpg
2025-06-04 22:45:28,168 - INFO - 2a03:2880:10ff:7e:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:45:28,169 - INFO - Message queued for user 919530251797 - processing already active
2025-06-04 22:45:31,173 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles/uploads/793b5f9c63c945a58fbe087af8f8d61e.jpg
2025-06-04 22:45:37,660 - INFO - Sent response to user 919530251797, seq 8.
2025-06-04 22:45:38,674 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:45:38,675 - INFO - 2a03:2880:22ff:72:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:45:38,867 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:45:38,867 - INFO - 2a03:2880:22ff:5:::0 - "POST /webhook HTTP/1.1" 200
2025-06-04 22:45:39,919 - WARNING - Webhook payload does not include a phone number.
2025-06-04 22:45:39,920 - INFO - 2a03:2880:10ff:f:::0 - "POST /webhook HTTP/1.1" 200
2025-06-05 01:47:45,529 - ERROR - t=2025-06-05T01:47:45+0530 lvl=eror msg="heartbeat timeout, terminating session" obj=tunnels.session obj=csess id=df341fb7fcf0 clientid=66dd93c9e4b982b5ab971dde82fb83ab
2025-06-05 01:47:45,578 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-06-05 01:47:46,623 - ERROR - t=2025-06-05T01:47:45+0530 lvl=eror msg="session closed, starting reconnect loop" obj=tunnels.session obj=csess id=f76ddcae3bc3 err="session closed"
2025-06-05 01:47:46,623 - INFO - Cleaned up processing task for user 919530251797.
2025-06-05 07:59:28,744 - ERROR - t=2025-06-05T07:59:27+0530 lvl=eror msg="heartbeat timeout, terminating session" obj=tunnels.session obj=csess id=af6e86ee0a49 clientid=66dd93c9e4b982b5ab971dde82fb83ab
2025-06-05 07:59:28,978 - ERROR - t=2025-06-05T07:59:28+0530 lvl=eror msg="session closed, starting reconnect loop" obj=tunnels.session obj=csess id=f76ddcae3bc3 err="session closed"
2025-06-05 07:59:29,032 - ERROR - t=2025-06-05T07:59:29+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="failed to dial ngrok server with address \"connect.ngrok-agent.com:443\": dial tcp: lookup connect.ngrok-agent.com: no such host"
2025-06-05 07:59:29,532 - ERROR - t=2025-06-05T07:59:29+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="failed to dial ngrok server with address \"connect.ngrok-agent.com:443\": dial tcp: lookup connect.ngrok-agent.com: no such host"
2025-06-05 07:59:30,569 - ERROR - t=2025-06-05T07:59:30+0530 lvl=eror msg="failed to reconnect session" obj=tunnels.session err="failed to dial ngrok server with address \"connect.ngrok-agent.com:443\": dial tcp: lookup connect.ngrok-agent.com: no such host"
2025-06-05 08:11:41,252 - INFO - Shutting down
2025-06-05 08:11:41,361 - INFO - Waiting for application shutdown.
2025-06-05 08:11:41,361 - INFO - Shutting down server and ngrok tunnel...
2025-06-05 08:11:41,723 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-05 08:11:41,723 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-05 08:11:41,724 - INFO - Application shutdown complete.
2025-06-05 08:11:41,724 - INFO - Finished server process [26592]
2025-06-05 08:44:37,596 - INFO - Starting WhatsApp FastAPI app
2025-06-05 08:44:37,758 - INFO - Started server process [32036]
2025-06-05 08:44:37,759 - INFO - Waiting for application startup.
2025-06-05 08:44:38,502 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-05 08:44:38,521 - INFO - Starting the FastAPI app with lifespan.
2025-06-05 08:44:38,521 - INFO - Application startup complete.
2025-06-05 08:44:38,522 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-05 08:44:51,113 - INFO - User 919530251797 found in Redis cache.
2025-06-05 08:44:51,113 - INFO - Received image from 919530251797
2025-06-05 08:44:55,379 - INFO - Uploaded media to GCS: https://storage.googleapis.com/nashermiles2/uploads/1d42943633414d11a24dd40118cbefaf.jpg
2025-06-05 08:44:55,380 - INFO - 2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 200
2025-06-05 08:44:55,381 - INFO - Started message processing for user 919530251797
2025-06-05 08:44:58,395 - INFO - Processing batched messages for 919530251797: https://storage.googleapis.com/nashermiles2/uploads/1d42943633414d11a24dd40118cbefaf.jpg
2025-06-05 08:45:11,340 - INFO - Sent response to user 919530251797, seq 1.
2025-06-05 08:45:12,888 - WARNING - Webhook payload does not include a phone number.
2025-06-05 08:45:12,888 - INFO - 2a03:2880:10ff:40:::0 - "POST /webhook HTTP/1.1" 200
2025-06-05 08:45:13,025 - WARNING - Webhook payload does not include a phone number.
2025-06-05 08:45:13,026 - INFO - 2a03:2880:10ff:71:::0 - "POST /webhook HTTP/1.1" 200
2025-06-05 08:45:13,528 - WARNING - Webhook payload does not include a phone number.
2025-06-05 08:45:13,528 - INFO - 2a03:2880:12ff:1:::0 - "POST /webhook HTTP/1.1" 200
2025-06-05 08:47:28,409 - INFO - User 919530251797 has been idle for too long, cancelling queue processing.
2025-06-05 08:47:28,410 - INFO - Cleaned up processing task for user 919530251797.
2025-06-05 08:56:38,192 - INFO - Shutting down
2025-06-05 08:56:38,302 - INFO - Waiting for application shutdown.
2025-06-05 08:56:38,303 - INFO - Shutting down server and ngrok tunnel...
2025-06-05 08:56:38,347 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-05 08:56:38,347 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-05 08:56:38,350 - INFO - Application shutdown complete.
2025-06-05 08:56:38,351 - INFO - Finished server process [32036]
2025-06-05 08:56:52,873 - INFO - Starting WhatsApp FastAPI app
2025-06-05 08:56:53,009 - INFO - Started server process [5576]
2025-06-05 08:56:53,010 - INFO - Waiting for application startup.
2025-06-05 08:56:53,600 - INFO - Ngrok tunnel URL: https://keen-fowl-gently.ngrok-free.app
2025-06-05 08:56:53,609 - INFO - Starting the FastAPI app with lifespan.
2025-06-05 08:56:53,610 - INFO - Application startup complete.
2025-06-05 08:56:53,611 - INFO - Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
2025-06-05 08:56:55,237 - INFO - Shutting down
2025-06-05 08:56:55,347 - INFO - Waiting for application shutdown.
2025-06-05 08:56:55,348 - INFO - Shutting down server and ngrok tunnel...
2025-06-05 08:56:55,385 - INFO - Lifespan shutdown: Backed up unique users.
2025-06-05 08:56:55,386 - INFO - Lifespan shutdown: Cleaned up resources.
2025-06-05 08:56:55,386 - INFO - Application shutdown complete.
2025-06-05 08:56:55,387 - INFO - Finished server process [5576]
